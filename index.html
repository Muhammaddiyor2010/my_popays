<!DOCTYPE html>
<html lang="uz">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Popays Fast Food - Eng Mazali Taomlar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Yandex Maps API -->
    <script src="https://api-maps.yandex.ru/2.1/?apikey=YOUR_API_KEY&lang=uz_UZ" type="text/javascript"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap');

        * {
            font-family: 'Poppins', sans-serif;
        }

        .glow {
            box-shadow: 0 0 30px rgba(255, 149, 0, 0.5);
        }

        .float-animation {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .slide-in {
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        .admin-tab {
            transition: all 0.3s ease;
        }

        .admin-tab-content {
            transition: opacity 0.3s ease;
        }

        .admin-tab.active {
            background: linear-gradient(135deg, #9333ea, #7c3aed);
        }

        .branch-btn {
            transition: all 0.3s ease;
        }

        .branch-btn:hover {
            transform: scale(1.05);
        }

        .branch-btn.selected {
            border-color: #f97316 !important;
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(249, 115, 22, 0.3);
        }

        /* Loading Animation Styles */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1f2937, #111827, #000000);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease-out;
        }

        .loading-screen.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        .logo-container {
            position: relative;
            margin-bottom: 2rem;
        }

        .logo-spinner {
            width: 120px;
            height: 120px;
            border: 4px solid rgba(255, 149, 0, 0.2);
            border-top: 4px solid #ff9500;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .logo-text {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(45deg, #ff9500, #ff6b35, #ff9500);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 2s ease-in-out infinite;
            text-align: center;
        }

        @keyframes gradientShift {

            0%,
            100% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }
        }

        .loading-dots {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .loading-dot {
            width: 12px;
            height: 12px;
            background: #ff9500;
            border-radius: 50%;
            animation: dotPulse 1.4s ease-in-out infinite both;
        }

        .loading-dot:nth-child(1) {
            animation-delay: -0.32s;
        }

        .loading-dot:nth-child(2) {
            animation-delay: -0.16s;
        }

        .loading-dot:nth-child(3) {
            animation-delay: 0s;
        }

        @keyframes dotPulse {

            0%,
            80%,
            100% {
                transform: scale(0.8);
                opacity: 0.5;
            }

            40% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .loading-text {
            color: #9ca3af;
            font-size: 1rem;
            margin-top: 1rem;
            animation: fadeInOut 2s ease-in-out infinite;
        }

        @keyframes fadeInOut {

            0%,
            100% {
                opacity: 0.5;
            }

            50% {
                opacity: 1;
            }
        }

        /* Hide main content initially */
        .main-content {
            opacity: 0;
            transition: opacity 0.5s ease-in;
        }

        .main-content.loaded {
            opacity: 1;
        }

        /* Trending Products Carousel Styles */
        .trending-product-card {
            min-width: 100%;
            flex-shrink: 0;
            background: linear-gradient(145deg, #1f2937 0%, #111827 50%, #0f172a 100%);
            border: 2px solid transparent;
            background-clip: padding-box;
            position: relative;
            overflow: hidden;
            box-shadow: 0 15px 30px -8px rgba(0, 0, 0, 0.4);
        }

        @media (min-width: 640px) {
            .trending-product-card {
                max-width: 60%;
                border: 3px solid transparent;
                box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            }
        }

        .trending-product-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 1.5rem;
            padding: 3px;
            background: linear-gradient(145deg, #f97316, #ef4444, #dc2626, #f97316);
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: exclude;
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask-composite: exclude;
            animation: borderGlow 3s ease-in-out infinite;
        }

        .trending-product-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(249, 115, 22, 0.2), transparent);
            animation: shimmer 3s infinite;
            z-index: 1;
        }

        .trending-product-card:hover {
            transform: scale(1.01) translateY(-2px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 20px 40px -8px rgba(249, 115, 22, 0.2);
        }

        @media (min-width: 640px) {
            .trending-product-card:hover {
                transform: scale(1.02) translateY(-3px);
                box-shadow: 0 25px 50px -10px rgba(249, 115, 22, 0.25);
            }
        }

        @media (min-width: 1024px) {
            .trending-product-card:hover {
                transform: scale(1.03) translateY(-5px);
                transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                box-shadow: 0 35px 60px -12px rgba(249, 115, 22, 0.3);
            }
        }

        /* Line clamp utility */
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .trending-badge {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            background: linear-gradient(135deg, #ef4444, #f97316, #dc2626);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-weight: 800;
            font-size: 0.75rem;
            z-index: 10;
            animation: pulse 2s infinite, float 3s ease-in-out infinite;
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.4);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        @media (min-width: 640px) {
            .trending-badge {
                max-height: 500px;
                top: 1rem;
                right: 1rem;
                padding: 0.6rem 1.2rem;
                font-size: 0.8rem;
                box-shadow: 0 10px 25px rgba(239, 68, 68, 0.4);
            }
        }

        @media (min-width: 1024px) {
            .trending-badge {
                top: 1.5rem;
                right: 1.5rem;
                padding: 0.75rem 1.5rem;
                font-size: 0.875rem;
            }
        }

        .trending-dot.active {
            background: linear-gradient(135deg, #f97316, #ef4444);
            transform: scale(1.3);
            box-shadow: 0 0 20px rgba(249, 115, 22, 0.6);
        }

        .trending-carousel-container {
            position: relative;
            background: linear-gradient(145deg, rgba(31, 41, 55, 0.8), rgba(17, 24, 39, 0.9));
            backdrop-filter: blur(20px);
        }

        .trending-carousel-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                rgba(0,0,0,0.6) 0%, 
                transparent 15%, 
                transparent 85%, 
                rgba(0,0,0,0.6) 100%);
            pointer-events: none;
            z-index: 5;
        }

        /* Animations */
        @keyframes pulse {
            0%, 100% { 
                transform: scale(1); 
                box-shadow: 0 10px 25px rgba(239, 68, 68, 0.4);
            }
            50% { 
                transform: scale(1.05); 
                box-shadow: 0 15px 35px rgba(239, 68, 68, 0.6);
            }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }

        @keyframes borderGlow {
            0%, 100% { 
                background: linear-gradient(145deg, #f97316, #ef4444, #dc2626, #f97316);
            }
            50% { 
                background: linear-gradient(145deg, #ef4444, #f97316, #dc2626, #ef4444);
            }
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        /* Trending section title animation */
        .trending-title {
            background: linear-gradient(45deg, #f97316, #ef4444, #dc2626, #f97316);
            background-size: 400% 400%;
            animation: gradientShift 4s ease infinite;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Yandex Map styles */
        #locationMap {
            background: linear-gradient(135deg, #1e293b, #334155);
        }

        .ymaps-2-1-79-map {
            background: transparent !important;
        }

        .ymaps-2-1-79-popup__content {
            background: rgba(30, 41, 59, 0.95) !important;
            color: white !important;
            border: 1px solid #f97316 !important;
            border-radius: 8px !important;
            padding: 10px !important;
        }

        .custom-marker {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
                opacity: 1;
            }

            50% {
                transform: scale(1.2);
                opacity: 0.8;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Category Card Animations */
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .category-card {
            animation: slideInUp 0.5s ease-out forwards;
            opacity: 0;
        }

        /* Shake animation for wrong credentials */
        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            10%,
            30%,
            50%,
            70%,
            90% {
                transform: translateX(-10px);
            }

            20%,
            40%,
            60%,
            80% {
                transform: translateX(10px);
            }
        }
    </style>
</head>

<body class="bg-gradient-to-br from-gray-900 via-gray-800 to-black text-white">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="logo-container">
            <div class="logo-spinner"></div>
            <div class="logo-text">POPAYS</div>
        </div>
        <div class="loading-dots">
            <div class="loading-dot"></div>
            <div class="loading-dot"></div>
            <div class="loading-dot"></div>
        </div>
        <div class="loading-text">Tashrifingiz uchun raxmat!</div>
    </div>

    <!-- Main Content -->
    <div id="mainContent" class="main-content">
        <!-- Navbar -->
        <nav class="bg-black/50 backdrop-blur-xl border-b border-orange-500/30 sticky top-0 z-50">
            <div class="container mx-auto px-4 py-3 md:py-4 flex justify-between items-center">
                <div class="flex items-center space-x-2">
                    <div
                        class="w-10 h-10 md:w-12 md:h-12 rounded-full flex items-center justify-center float-animation overflow-hidden">
                        <img src="imgs/popays_logo.jpg" alt="Popays Logo" class="w-full h-full object-cover">
                    </div>
                    <h1
                        class="text-xl md:text-2xl font-bold bg-gradient-to-r from-orange-400 to-red-500 bg-clip-text text-transparent">
                        POPAYS
                    </h1>
                </div>
                <!-- Desktop Navigation -->
                <div class="hidden md:flex space-x-8">
                    <a href="#menu" class="hover:text-orange-400 transition duration-300 hover:scale-110">Menyu</a>
                    <a href="#about" class="hover:text-orange-400 transition duration-300 hover:scale-110">Biz
                        haqimizda</a>
                    <a href="#contact" class="hover:text-orange-400 transition duration-300 hover:scale-110">Aloqa</a>
                </div>

                <!-- Mobile Menu Button -->
                <button id="mobileMenuBtn" onclick="toggleMobileMenu()"
                    class="md:hidden text-white hover:text-orange-400 transition duration-300">
                    <i class="fas fa-bars text-xl"></i>
                </button>

                <!-- Cart Button -->
                <button onclick="toggleCart()"
                    class="relative bg-gradient-to-r from-orange-500 to-red-600 px-3 py-2 md:px-4 rounded-full hover:scale-110 transition duration-300 glow">
                    <i class="fas fa-shopping-cart text-sm md:text-base"></i>
                    <span id="cartCount"
                        class="absolute -top-2 -right-2 bg-yellow-400 text-black rounded-full w-5 h-5 md:w-6 md:h-6 flex items-center justify-center text-xs font-bold">0</span>
                </button>

            </div>
        </nav>

        <!-- Mobile Navigation Menu -->
        <div id="mobileMenu"
            class="fixed inset-0 bg-black/90 backdrop-blur-sm z-40 transform -translate-x-full transition-transform duration-300 ease-in-out md:hidden">
            <div class="flex flex-col h-full">
                <!-- Mobile Menu Header -->
                <div class="flex justify-between items-center p-4 border-b border-orange-500/30">
                    <div class="flex items-center space-x-2 ">
                        <img src="imgs/popays_logo.jpg" alt="Popays Logo" class="w-10 h-10 rounded-full border border-orange-500/30">
                        <h2
                            class="text-xl font-bold bg-gradient-to-r from-orange-400 to-red-500 bg-clip-text text-transparent">
                            POPAYS</h2>
                    </div>
                    <button onclick="toggleMobileMenu()"
                        class="text-white hover:text-orange-400 transition duration-300">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <!-- Mobile Menu Links -->
                <div class="flex-1 flex flex-col justify-center items-center space-y-8">
                    <a href="#menu" onclick="toggleMobileMenu()"
                        class="text-2xl font-semibold text-white hover:text-orange-400 transition duration-300 hover:scale-110">
                        <i class="fas fa-utensils mr-3"></i>Menyu
                    </a>
                    <a href="#about" onclick="toggleMobileMenu()"
                        class="text-2xl font-semibold text-white hover:text-orange-400 transition duration-300 hover:scale-110">
                        <i class="fas fa-info-circle mr-3"></i>Biz haqimizda
                    </a>
                    <a href="#contact" onclick="toggleMobileMenu()"
                        class="text-2xl font-semibold text-white hover:text-orange-400 transition duration-300 hover:scale-110">
                        <i class="fas fa-phone mr-3"></i>Aloqa
                    </a>
                </div>

                <!-- Mobile Menu Footer -->
                <div class="p-4 border-t border-orange-500/30">
                    <button onclick="toggleCart(); toggleMobileMenu();"
                        class="w-full bg-gradient-to-r from-orange-500 to-red-600 py-3 rounded-lg font-semibold hover:scale-105 transition duration-300 flex items-center justify-center">
                        <i class="fas fa-shopping-cart mr-2"></i>
                        Savat (<span id="mobileCartCount">0</span>)
                    </button>
                </div>
            </div>
        </div>

        <!-- Customer Info Modal removed - now integrated into cart modal -->





        <!-- Add Product Modal -->
        <div id="addProductModal"
            class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
            <div
                class="bg-gradient-to-br from-gray-900 to-gray-800 rounded-3xl p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto border border-green-500/30 slide-in">
                <div class="flex justify-between items-center mb-6">
                    <h3
                        class="text-2xl font-bold bg-gradient-to-r from-green-400 to-green-500 bg-clip-text text-transparent">
                        ‚ûï Yangi Mahsulot Qo'shish
                    </h3>
                    <button onclick="hideAddProductForm()" class="text-gray-400 hover:text-white text-2xl">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <form id="addProductForm" class="space-y-4">
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2 text-gray-300">Mahsulot nomi</label>
                            <input type="text" id="newProductName" required
                                class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 text-white focus:border-green-500 focus:outline-none transition">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2 text-gray-300">Kategoriya</label>
                            <select id="newProductCategory" required
                                class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 text-white focus:border-green-500 focus:outline-none transition">
                                <option value="">Kategoriyani tanlang</option>
                                <option value="burger">Burgerlar</option>
                                <option value="lavash">Lavashlar</option>
                                <option value="combo">Combo</option>
                                <option value="drinks">Ichimliklar</option>
                                <option value="hotdog">Hot Dog</option>
                                <option value="sides">Snacklar</option>
                                <option value="twister">Twister</option>
                                <option value="pizza">Pizza</option>
                                </se lect>
                        </div>
                    </div>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2 text-gray-300">Narxi (so'm)</label>
                            <input type="number" id="newProductPrice" required
                                class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 text-white focus:border-green-500 focus:outline-none transition">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2 text-gray-300">Rasm fayli</label>
                            <input type="file" id="newProductImage" accept="image/*"
                                class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 text-white focus:border-green-500 focus:outline-none transition">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2 text-gray-300">Tavsif</label>
                        <textarea id="newProductDescription" rows="3" required
                            class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 text-white focus:border-green-500 focus:outline-none transition resize-none"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2 text-gray-300">Badge (ixtiyoriy)</label>
                        <input type="text" id="newProductBadge"
                            class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 text-white focus:border-green-500 focus:outline-none transition"
                            placeholder="Masalan: NEW, TOP, HOT">
                    </div>
                    <button type="submit"
                        class="w-full bg-gradient-to-r from-green-500 to-green-600 py-3 rounded-lg font-semibold hover:scale-105 transition duration-300">
                        <i class="fas fa-save mr-2"></i>Mahsulotni Saqlash
                    </button>
                </form>
            </div>
        </div>

        <!-- Hero Section -->
        <section class="container mx-auto px-4 py-20 text-center flex flex-col items-center">
            <div class="mb-8">
                <img src="imgs/popays_logo.jpg" alt="Popays Logo"
                    class="w-32 h-32 md:w-40 md:h-40 mx-auto mb-6 float-animation rounded-full">
            </div>
            <h2
                class="text-5xl md:text-7xl max-w-[900px] font-bold mb-6 bg-gradient-to-r from-yellow-400 via-orange-500 to-red-600 bg-clip-text text-transparent">
                ENG MAZALI FAST FOOD
            </h2>
            <p class="text-xl mb-8 text-gray-300">üî• Tez yetkazib berish ‚Ä¢ üçî Yangi taomlar ‚Ä¢ üéâ Maxsus chegirmalar</p>
            <button onclick="scrollToMenu()"
                class="bg-gradient-to-r from-orange-500 to-red-600 px-8 py-4 rounded-full text-xl font-semibold hover:scale-110 transition duration-300 glow">
                Buyurtma Berish <i class="fas fa-arrow-right ml-2"></i>
            </button>
        </section>

        <!-- Special Offers -->
        <section class="container mx-auto px-4 py-10  ">
            <div
                class="bg-gradient-to-r from-purple-900/50 to-pink-900/50 rounded-3xl flex flex-col justify-center p-8 backdrop-blur-xl border border-purple-500/30">
                <div class="text-center mb-6">
                    <img src="imgs/popays_logo.jpg" alt="Popays Logo" class="w-20 h-20 mx-auto mb-4 float-animation rounded-full">
                    <h3 class="text-3xl font-bold" id="vipSectionTitle">üéÅ VIP AKSIYA</h3>
                </div>
                <div class="flex justify-center gap-8">
                    <div class="bg-black/30 rounded-xl p-4 text-center  max-w-xs">
                        <i class="fas fa-percentage text-4xl text-yellow-400 mb-2"></i>
                        <p class="font-semibold" id="vipDiscountText">Sovg'a</p>
                        <p class="text-sm text-gray-400" id="vipMinOrderText">Mahsulotmizni instagram strosisingizga
                            qoysangiz sovg'a</p>
                    </div>
                    <div class="bg-black/30 rounded-xl p-4 text-center  max-w-xs">
                        <i class="fas fa-truck text-4xl text-green-400 mb-2"></i>
                        <p class="font-semibold" id="vipFreeDeliveryTitle">BEPUL YETKAZIB BERISH</p>
                        <p class="text-sm text-gray-400" id="vipFreeDeliveryText">3km gacha bepul yetkazib berish</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Menu Section -->
        <section id="menu" class="w-4/5 mx-auto px-4 py-20">
            <div class="text-center mb-12">
                <img src="imgs/popays_logo.jpg" alt="Popays Logo" class="w-24 h-24 mx-auto mb-6 float-animation rounded-full">
                <h2
                    class="text-4xl font-bold bg-gradient-to-r from-orange-400 to-red-500 bg-clip-text text-transparent">
                    MAXSUS MENYU
                </h2>
            </div>

            <!-- Categories Grid -->
            <div id="categoriesGrid"
                class="grid grid-cols-1 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8 w-4/5 mx-auto">
                <!-- Categories will be loaded from database -->
            </div>

            <!-- Trending Products Section -->
            <div class="w-full px-4 sm:px-6 lg:px-8 mx-auto mb-16 mt-12 sm:mt-16 lg:mt-20">
                <div class="text-center mb-8 sm:mb-10 lg:mb-12">
                    <div class="inline-flex items-center justify-center w-12 h-12 sm:w-14 sm:h-14 lg:w-16 lg:h-16 rounded-full bg-gradient-to-r from-orange-500 to-red-500 mb-4 sm:mb-6 shadow-lg">
                        <span class="text-xl sm:text-2xl lg:text-3xl">üî•</span>
                    </div>
                    <h2 class="text-2xl sm:text-3xl md:text-4xl lg:text-5xl xl:text-6xl font-bold trending-title bg-clip-text text-transparent mb-4 sm:mb-6 px-4">
                        TRENDDAGI MAHSULOTLAR
                    </h2>
                    <p class="text-gray-300 text-sm sm:text-base lg:text-lg xl:text-xl max-w-2xl mx-auto leading-relaxed px-4">
                        Eng mashhur va sevimli taomlarimiz - mijozlarimiz orasida eng ko'p buyurtma beriladigan mahsulotlar
                    </p>
                </div>
                
                <!-- Trending Products Carousel -->
                <div class="relative overflow-hidden rounded-2xl sm:rounded-3xl trending-carousel-container bg-gradient-to-br from-gray-900/50 to-gray-800/50 backdrop-blur-sm border border-orange-500/20 shadow-2xl mx-2 sm:mx-0" 
                     onmouseenter="stopTrendingCarousel()" 
                     onmouseleave="startTrendingCarousel()">
                    <div id="trendingCarousel" class="flex transition-transform duration-1000 ease-in-out">
                        <!-- Trending products will be loaded here -->
                    </div>
                    
                    <!-- Navigation Dots -->
                    <div class="flex justify-center mt-6 sm:mt-8 space-x-2 sm:space-x-3 pb-4 sm:pb-0">
                        <button onclick="goToSlide(0)" class="trending-dot w-3 h-3 sm:w-4 sm:h-4 rounded-full bg-orange-500 transition-all duration-300 shadow-lg"></button>
                        <button onclick="goToSlide(1)" class="trending-dot w-3 h-3 sm:w-4 sm:h-4 rounded-full bg-gray-600 hover:bg-orange-400 transition-all duration-300 shadow-lg"></button>
                        <button onclick="goToSlide(2)" class="trending-dot w-3 h-3 sm:w-4 sm:h-4 rounded-full bg-gray-600 hover:bg-orange-400 transition-all duration-300 shadow-lg"></button>
                        <button onclick="goToSlide(3)" class="trending-dot w-3 h-3 sm:w-4 sm:h-4 rounded-full bg-gray-600 hover:bg-orange-400 transition-all duration-300 shadow-lg"></button>
                        <button onclick="goToSlide(4)" class="trending-dot w-3 h-3 sm:w-4 sm:h-4 rounded-full bg-gray-600 hover:bg-orange-400 transition-all duration-300 shadow-lg"></button>
                    </div>
                </div>
            </div>


        </section>

        <!-- Cart Modal -->
        <div id="cartModal"
            class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
            <div
                class="bg-gradient-to-br from-gray-900 to-gray-800 rounded-3xl p-8 max-w-2xl w-full max-h-[80vh] overflow-y-auto border border-orange-500/30 slide-in">
                <div class="flex justify-between items-center mb-6">
                    <h3
                        class="text-2xl font-bold bg-gradient-to-r from-orange-400 to-red-500 bg-clip-text text-transparent">
                        üõí Savat
                    </h3>
                    <button onclick="toggleCart()" class="text-gray-400 hover:text-white text-2xl">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div id="cartItems" class="space-y-4 mb-6">
                    <!-- Cart items will be added here -->
                </div>
                <div class="border-t border-gray-700 pt-4">
                    <!-- Branch Selection -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2 text-gray-300">
                            <i class="fas fa-store mr-2 text-blue-400"></i>Filialni tanlang:
                        </label>
                        <div class="grid grid-cols-2 gap-3">
                            <button id="branchKosmonavt" onclick="selectBranch('kosmonavt')"
                                class="branch-btn bg-gradient-to-r from-blue-500 to-blue-600 py-3 rounded-lg font-semibold hover:scale-105 transition duration-300 text-white border-2 border-transparent">
                                <i class="fas fa-building mr-2"></i>Kosmonavt
                            </button>
                            <button id="branchDerizli" onclick="selectBranch('derizli')"
                                class="branch-btn bg-gradient-to-r from-gray-600 to-gray-700 py-3 rounded-lg font-semibold hover:scale-105 transition duration-300 text-white border-2 border-transparent">
                                <i class="fas fa-store-alt mr-2"></i>Derizli
                            </button>
                        </div>
                        <div id="branchSelectionError" class="hidden text-red-400 text-sm mt-2 text-center">
                            <i class="fas fa-exclamation-circle mr-1"></i>Iltimos, filialni tanlang!
                        </div>
                    </div>

                    <!-- Customer Information -->
                    <div class="mb-4">
                        <h4 class="text-lg font-semibold text-white mb-3">
                            <i class="fas fa-user mr-2 text-orange-400"></i>Mijoz ma'lumotlari
                        </h4>

                        <div class="space-y-3">
                            <!-- Name -->
                            <div>
                                <label class="block text-sm font-medium mb-1 text-gray-300">Ismingiz *</label>
                                <input type="text" id="cartCustomerName" required
                                    class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-orange-500 focus:outline-none transition text-sm"
                                    placeholder="Ismingizni kiriting">
                            </div>

                            <!-- Phone -->
                            <div>
                                <label class="block text-sm font-medium mb-1 text-gray-300">Telefon raqamingiz *</label>
                                <input type="tel" id="cartCustomerPhone" required
                                    class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-orange-500 focus:outline-none transition text-sm"
                                    placeholder="+998 90 123 45 67">
                            </div>

                            <!-- Location -->
                            <div>
                                <label class="block text-sm font-medium mb-1 text-gray-300">
                                    <i class="fas fa-map-marker-alt mr-1 text-orange-400"></i>Lokatsiyangiz *
                                </label>
                                <div class="space-y-2">
                                    <button type="button" onclick="detectLocationForCart()"
                                        class="w-full bg-gradient-to-r from-green-500 to-emerald-600 py-2 rounded-lg font-semibold hover:scale-105 transition duration-300 text-white text-sm">
                                        <i class="fas fa-crosshairs mr-2"></i>Lokatsiyani aniqlash
                                    </button>
                                    <div id="cartLocationStatus" class="text-center text-xs text-gray-400">
                                        Lokatsiyani aniqlash uchun tugmani bosing
                                    </div>
                                    <input type="text" id="cartCustomLocation" placeholder="Yoki manzilingizni kiriting"
                                        class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-blue-500 focus:outline-none transition text-sm">
                                    <div id="cartSelectedLocationText"
                                        class="text-white font-medium text-sm bg-gray-700 rounded p-2">
                                        Lokatsiyani aniqlang yoki kiriting
                                    </div>
                                    <input type="hidden" id="cartCustomerLocation" required>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-between text-xl font-bold mb-4">
                        <span>Jami:</span>
                        <span id="cartTotal" class="text-orange-400">0 so'm</span>
                    </div>

                    <button onclick="checkoutFromCart()"
                        class="w-full bg-gradient-to-r from-green-500 to-green-600 py-3 rounded-full font-semibold hover:scale-105 transition duration-300">
                        ‚úÖ Buyurtma Berish
                    </button>
                </div>
            </div>
        </div>

        <!-- About Us Section -->
        <section id="about" class="container mx-auto px-4 py-20">
            <div class="text-center mb-12">
                <img src="imgs/popays_logo.jpg" alt="Popays Logo" class="w-24 h-24 mx-auto mb-6 float-animation rounded-full">
                <h2
                    class="text-4xl font-bold bg-gradient-to-r from-orange-400 to-red-500 bg-clip-text text-transparent">
                    BIZ HAQIMIZDA
                </h2>
            </div>
            <div class="grid md:grid-cols-2 gap-12 items-center">
                <div class="space-y-6">
                    <div
                        class="bg-gradient-to-r from-orange-500/20 to-red-500/20 rounded-2xl p-6 border border-orange-500/30">
                        <h3 class="text-2xl font-bold mb-4 text-orange-400">üèÜ Bizning Afzalliklarimiz</h3>
                        <ul class="space-y-3 text-gray-300">
                            <li class="flex items-center"><i class="fas fa-check-circle text-green-400 mr-3"></i><span
                                    id="aboutAdvantage1Text">Eng sifatli ingredientlar</span></li>
                            <li class="flex items-center"><i class="fas fa-check-circle text-green-400 mr-3"></i><span
                                    id="aboutAdvantage2Text">Tez va ishonchli yetkazib berish</span></li>
                            <li class="flex items-center"><i class="fas fa-check-circle text-green-400 mr-3"></i><span
                                    id="aboutAdvantage3Text">8:00 dan 3:00 gacha xizmat ko'rsatish</span></li>
                            <li class="flex items-center"><i class="fas fa-check-circle text-green-400 mr-3"></i><span
                                    id="aboutAdvantage4Text">Maxsus retseptlar va ziravorlar</span></li>
                        </ul>
                    </div>
                    <div
                        class="bg-gradient-to-r from-purple-500/20 to-pink-500/20 rounded-2xl p-6 border border-purple-500/30">
                        <h3 class="text-2xl font-bold mb-4 text-purple-400">üìà Bizning Natijalarimiz</h3>
                        <div class="grid grid-cols-2 gap-4 text-center">
                            <div>
                                <div class="text-3xl font-bold text-yellow-400" id="aboutCustomersText">2,000+</div>
                                <div class="text-sm text-gray-400">Mamnun mijozlar</div>
                            </div>
                            <div>
                                <div class="text-3xl font-bold text-green-400" id="aboutExperienceText">1,5 yil</div>
                                <div class="text-sm text-gray-400">Tajriba</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="space-y-6">
                    <div
                        class="bg-gradient-to-r from-blue-500/20 to-cyan-500/20 rounded-2xl p-6 border border-blue-500/30">
                        <h3 class="text-2xl font-bold mb-4 text-blue-400">üéØ Bizning Maqsadimiz</h3>
                        <p class="text-gray-300 leading-relaxed" id="aboutGoalText">
                            Dunyo miqyosida halol luqma tarqatish!!!
                        </p>
                    </div>
                    <div
                        class="bg-gradient-to-r from-green-500/20 to-emerald-500/20 rounded-2xl p-6 border border-green-500/30">
                        <h3 class="text-2xl font-bold mb-4 text-green-400">üåü Bizning Qiymatlarimiz</h3>
                        <p class="text-gray-300 leading-relaxed" id="aboutValuesText">
                            Sifat, ishonchlilik va mijozlar mamnuniyati - bu bizning asosiy tamoyillarimiz.
                            Har bir taom maxsus e'tibor bilan tayyorlanadi va sizning stolga yetkaziladi.
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Contact Section -->
        <section id="contact" class="container mx-auto px-4 py-20">
            <div class="text-center mb-12">
                <img src="imgs/popays_logo.jpg" alt="Popays Logo" class="w-24 h-24 mx-auto mb-6 float-animation rounded-full">
                <h2
                    class="text-4xl font-bold bg-gradient-to-r from-orange-400 to-red-500 bg-clip-text text-transparent">
                    ALOQA
                </h2>
            </div>
            <div class="grid md:grid-cols-2 gap-12">
                <!-- Contact Information -->
                <div class="space-y-6">
                    <div
                        class="bg-gradient-to-r from-orange-500/20 to-red-500/20 rounded-2xl p-6 border border-orange-500/30">
                        <h3 class="text-2xl font-bold mb-6 text-orange-400">üìû Biz bilan bog'laning</h3>
                        <div class="space-y-4">
                            <div class="flex items-center space-x-4">
                                <div class="w-12 h-12 bg-orange-500 rounded-full flex items-center justify-center">
                                    <i class="fas fa-phone text-white"></i>
                                </div>
                                <div>
                                    <div class="font-semibold">Telefon</div>
                                    <div class="text-gray-300 ">Kosmonavt filialimiz +998912690002 <br>
                                        Derizli filialimiz +998332002211 </div>
                                </div>
                            </div>
                            <div class="flex items-center space-x-4">
                                <div class="w-12 h-12 bg-red-500 rounded-full flex items-center justify-center">
                                    <i class="fas fa-envelope text-white"></i>
                                </div>
                                <div>
                                    <div class="font-semibold">Email</div>
                                    <div class="text-gray-300">info@popays.uz</div>
                                </div>
                            </div>
                            <div class="flex items-center space-x-4">
                                <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center">
                                    <i class="fas fa-map-marker-alt text-white"></i>
                                </div>
                                <div>
                                    <div class="font-semibold">Manzil</div>
                                    <div class="text-gray-300">Qo'qon shahri kosmonavt<br>Qo'qon shaxri Derizli
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center space-x-4">
                                <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center">
                                    <i class="fas fa-clock text-white"></i>
                                </div>
                                <div>
                                    <div class="font-semibold">Ish vaqti</div>
                                    <div class="text-gray-300">24/7 - kun bo'yi</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div
                        class="bg-gradient-to-r from-purple-500/20 to-pink-500/20 rounded-2xl p-6 border border-purple-500/30">
                        <h3 class="text-2xl font-bold mb-4 text-purple-400">üì± Ijtimoiy tarmoqlar</h3>
                        <div class="grid grid-cols-3 gap-4">
                            <a href="https://www.instagram.com/popays_uz?igsh=MXFveWkyOWE0cnY0NA%3D%3D&utm_source=qr"
                                target="_blank"
                                class="bg-gradient-to-r from-pink-500 to-purple-600 p-4 rounded-xl text-center hover:scale-105 transition duration-300">
                                <i class="fab fa-instagram text-2xl mb-2"></i>
                                <div class="text-sm">Instagram</div>
                            </a>
                            <a href="https://t.me/popays_kokand" target="_blank"
                                class="bg-gradient-to-r from-blue-500 to-cyan-600 p-4 rounded-xl text-center hover:scale-105 transition duration-300">
                                <i class="fab fa-telegram text-2xl mb-2"></i>
                                <div class="text-sm">Telegram</div>
                            </a>
                            <a href="https://t.me/popays_admin" target="_blank"
                                class="bg-gradient-to-r from-green-500 to-emerald-600 p-4 rounded-xl text-center hover:scale-105 transition duration-300">
                                <i class="fas fa-user text-2xl mb-2"></i>
                                <div class="text-sm">Admin</div>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Contact Form -->
                <div class="bg-gradient-to-r from-gray-800/50 to-gray-900/50 rounded-2xl p-8 border border-gray-700">
                    <h3 class="text-2xl font-bold mb-6 text-center">‚úâÔ∏è Xabar yozing</h3>
                    <form id="contactForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Ismingiz</label>
                            <input type="text" id="contactName" required
                                class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 text-white focus:border-orange-500 focus:outline-none transition"
                                placeholder="Ismingizni kiriting">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Telefon</label>
                            <input type="tel" id="contactPhone" required
                                class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 text-white focus:border-orange-500 focus:outline-none transition"
                                placeholder="+998 91 269 00 02">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Email</label>
                            <input type="email" id="contactEmail"
                                class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 text-white focus:border-orange-500 focus:outline-none transition"
                                placeholder="email@example.com">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Xabar</label>
                            <textarea id="contactMessage" rows="4" required
                                class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 text-white focus:border-blue-500 focus:outline-none transition resize-none"
                                placeholder="Xabaringizni yozing..."></textarea>
                        </div>
                        <button type="submit"
                            class="w-full bg-gradient-to-r from-orange-500 to-red-600 py-3 rounded-lg font-semibold hover:scale-105 transition duration-300">
                            <i class="fas fa-paper-plane mr-2"></i>Xabar yuborish
                        </button>
                    </form>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="bg-black/50 backdrop-blur-xl border-t border-orange-500/30 mt-20">
            <div class="container mx-auto px-4 py-8">
                <div class="grid md:grid-cols-3 gap-8">
                    <div>
                        <div class="flex items-center space-x-3 mb-4">
                            <img src="imgs/popays_logo.jpg" alt="Popays Logo" class="w-12 h-12 rounded-full">
                            <h4 class="text-xl font-bold text-orange-400">Popays Fast Food</h4>
                        </div>
                        <p class="text-gray-400">Eng mazali va sifatli fast food. Qo'qon va atrofida yetkazib berish.
                            8:00 dan 3:00 gacha xizmat ko'rsatish.</p>
                    </div>
                    <div>
                        <h4 class="text-xl font-bold mb-4 text-orange-400">Aloqa</h4>
                        <p class="text-gray-400"><i class="fas fa-phone mr-2"></i> +998 91 269 00 02 <br> +998 33 200 22
                            11</p>
                        <p class="text-gray-400"><i class="fas fa-envelope mr-2"></i> popays482@gmail.com</p>
                    </div>
                    <div>
                        <h4 class="text-xl font-bold mb-4 text-orange-400">Ijtimoiy tarmoqlar</h4>
                        <div class="flex space-x-4">
                            <a href="https://www.instagram.com/popays_uz?igsh=MXFveWkyOWE0cnY0NA%3D%3D&utm_source=qr"
                                target="_blank" class="text-2xl hover:text-orange-400 transition"><i
                                    class="fab fa-instagram"></i></a>
                            <a href="https://t.me/popays_kokand" target="_blank"
                                class="text-2xl hover:text-orange-400 transition"><i class="fab fa-telegram"></i></a>
                            <a href="https://t.me/popays_admin" target="_blank"
                                class="text-2xl hover:text-orange-400 transition"><i class="fas fa-user"></i></a>
                        </div>
                    </div>
                </div>
                <div class="text-center mt-8 pt-8 border-t border-gray-800">
                    <p class="text-gray-500">¬© 2024 Popays Fast Food. Barcha huquqlar himoyalangan.</p>
                </div>
            </div>
        </footer>

        <script>
            // Trending Products Variables
            let currentTrendingSlide = 0;
            let trendingProducts = [];
            let trendingInterval;

            // Load trending products
            async function loadTrendingProducts() {
                try {
                    console.log('üî• Loading trending products...');
                    
                    // Define trending products manually (you can modify these)
                    trendingProducts = [
                        { id: 11, name: "Double Cheese burger", price: 45000, image: "./imgs/Double cheese burger.jpg", description: "Ikki xil pishloq, go'sht, sous va sabzavotlar bilan burger" },
                        { id: 41, name: "Donar Pizza", price: 70000, image: "./imgs/danar pizza.jpg", description: "Donar go'shti, pishloq va sabzavotlar bilan pizza" },
                        { id: 5, name: "Go'shtli HotDog", price: 25000, image: "./imgs/hotdog go'shtli.jpg", description: "Go'shtli kolbasa, sous va sabzavotlar bilan to'yingan hotdog" },
                        { id: 15, name: "Extra Lavash", price: 33000, image: "./imgs/lavash extra.jpg", description: "Qo'shimcha go'sht, sous va sabzavotlar bilan to'yingan lavash" },
                        { id: 22, name: "Qanotcha", price: 30000, image: "./imgs/qanotcha.jpg", description: "Tovuq qanotchalari - qovurilgan tovuq qanotlari, sous bilan" }
                    ];

                    displayTrendingProducts();
                    startTrendingCarousel();
                    
                } catch (error) {
                    console.error('‚ùå Error loading trending products:', error);
                }
            }

            // Display trending products
            function displayTrendingProducts() {
                const carousel = document.getElementById('trendingCarousel');
                if (!carousel || !trendingProducts.length) return;

                carousel.innerHTML = '';
                
                trendingProducts.forEach((product, index) => {
                    const productCard = document.createElement('div');
                    productCard.className = 'trending-product-card';
                    productCard.innerHTML = `
                        <div class="relative p-4 sm:p-6 lg:p-8 xl:p-10 h-[320px] sm:h-[380px] lg:h-[420px] xl:h-[450px] flex flex-col justify-between z-10">
                            <div class="trending-badge">üî• TRENDING</div>
                            
                            <!-- Mobile Layout (Stacked) -->
                            <div class="flex flex-col sm:hidden">
                                <div class="flex-1 flex items-center justify-center mb-4">
                                    <div class="relative">
                                        <div class="absolute inset-0 bg-gradient-to-br from-orange-500/20 to-red-500/20 rounded-2xl blur-lg"></div>
                                        <img src="${product.image}" alt="${product.name}" 
                                             class="relative w-32 h-32 object-cover rounded-2xl shadow-xl border-2 border-orange-500/20">
                                        <div class="absolute inset-0 bg-gradient-to-t from-black/30 via-transparent to-transparent rounded-2xl"></div>
                                        <div class="absolute top-2 left-2 bg-white/10 backdrop-blur-sm rounded-full p-2">
                                            <i class="fas fa-star text-yellow-400 text-sm"></i>
                                        </div>
                                    </div>
                                </div>
                                <div class="text-center">
                                    <h3 class="text-lg font-black text-white mb-3 leading-tight">${product.name}</h3>
                                    <p class="text-gray-200 mb-4 text-xs leading-relaxed font-medium line-clamp-2">${product.description}</p>
                                    <div class="flex flex-col items-center space-y-3">
                                        <div class="text-center">
                                            <span class="text-2xl font-black bg-gradient-to-r from-orange-400 via-red-500 to-orange-600 bg-clip-text text-transparent block">
                                                ${product.price.toLocaleString()} so'm
                                            </span>
                                            <span class="text-xs text-gray-400 font-medium">Eng mashhur mahsulot</span>
                                        </div>
                                        <button onclick="addToCart(${product.id})" 
                                                class="group bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-600 hover:to-red-700 text-white px-6 py-3 rounded-xl font-bold transition-all duration-300 hover:scale-105 shadow-xl border-2 border-transparent hover:border-orange-300">
                                            <i class="fas fa-cart-plus mr-2 group-hover:scale-110 transition-transform duration-300"></i>
                                            <span class="group-hover:tracking-wide transition-all duration-300">Buyurtma</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Desktop Layout (Side by Side) -->
                            <div class="hidden sm:flex items-center justify-between h-full">
                                <div class="flex-1 pr-4 lg:pr-6 xl:pr-8">
                                    <h3 class="text-xl lg:text-2xl xl:text-3xl font-black text-white mb-3 lg:mb-4 xl:mb-6 leading-tight">${product.name}</h3>
                                    <p class="text-gray-200 mb-4 lg:mb-6 xl:mb-8 text-sm lg:text-base leading-relaxed font-medium">${product.description}</p>
                                    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-3 lg:space-y-0">
                                        <div class="flex flex-col">
                                            <span class="text-2xl lg:text-3xl xl:text-4xl font-black bg-gradient-to-r from-orange-400 via-red-500 to-orange-600 bg-clip-text text-transparent mb-1 lg:mb-2">
                                                ${product.price.toLocaleString()} so'm
                                            </span>
                                            <span class="text-xs lg:text-sm text-gray-400 font-medium">Eng mashhur mahsulot</span>
                                        </div>
                                        <button onclick="addToCart(${product.id})" 
                                                class="group bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-600 hover:to-red-700 text-white px-6 lg:px-8 py-3 lg:py-4 rounded-xl lg:rounded-2xl font-bold transition-all duration-300 hover:scale-110 shadow-2xl hover:shadow-orange-500/25 border-2 border-transparent hover:border-orange-300 w-full lg:w-auto">
                                            <i class="fas fa-cart-plus mr-2 lg:mr-3 group-hover:scale-110 transition-transform duration-300"></i>
                                            <span class="group-hover:tracking-wide transition-all duration-300">Buyurtma</span>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="flex-shrink-0">
                                    <div class="relative group">
                                        <div class="absolute inset-0 bg-gradient-to-br from-orange-500/20 to-red-500/20 rounded-2xl lg:rounded-3xl blur-lg lg:blur-xl group-hover:blur-xl lg:group-hover:blur-2xl transition-all duration-500"></div>
                                        <img src="${product.image}" alt="${product.name}" 
                                             class="relative w-32 h-32 sm:w-40 sm:h-40 lg:w-48 lg:h-48 xl:w-52 xl:h-52 object-cover rounded-2xl lg:rounded-3xl shadow-2xl group-hover:scale-105 transition-all duration-500 border-2 lg:border-4 border-orange-500/20">
                                        <div class="absolute inset-0 bg-gradient-to-t from-black/30 via-transparent to-transparent rounded-2xl lg:rounded-3xl"></div>
                                        <div class="absolute top-2 lg:top-4 left-2 lg:left-4 bg-white/10 backdrop-blur-sm rounded-full p-2 lg:p-3">
                                            <i class="fas fa-star text-yellow-400 text-sm lg:text-lg"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    carousel.appendChild(productCard);
                });

                updateTrendingDots();
            }

            // Start automatic carousel
            function startTrendingCarousel() {
                trendingInterval = setInterval(() => {
                    currentTrendingSlide = (currentTrendingSlide + 1) % trendingProducts.length;
                    goToSlide(currentTrendingSlide);
                }, 4000); // Change slide every 4 seconds
            }

            // Stop automatic carousel
            function stopTrendingCarousel() {
                if (trendingInterval) {
                    clearInterval(trendingInterval);
                }
            }

            // Go to specific slide
            function goToSlide(slideIndex) {
                const carousel = document.getElementById('trendingCarousel');
                if (!carousel) return;

                currentTrendingSlide = slideIndex;
                carousel.style.transform = `translateX(-${currentTrendingSlide * 100}%)`;
                updateTrendingDots();
            }

            // Update navigation dots
            function updateTrendingDots() {
                const dots = document.querySelectorAll('.trending-dot');
                dots.forEach((dot, index) => {
                    if (index === currentTrendingSlide) {
                        dot.classList.add('active');
                    } else {
                        dot.classList.remove('active');
                    }
                });
            }

            // Load categories directly from JSON file
            async function loadCategories() {
                console.log('üîÑ Loading categories from JSON file...');
                const grid = document.getElementById('categoriesGrid');

                if (!grid) {
                    console.error('‚ùå categoriesGrid element not found!');
                    return;
                }

                // Show loading state
                grid.innerHTML = '<div class="col-span-full text-center text-gray-400 py-8">üîÑ Kategoriyalar yuklanmoqda...</div>';

                try {
                    console.log('üì° Fetching categories.json...');
                    const response = await fetch('./categories.json');

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status} - ${response.statusText}`);
                    }

                    const categories = await response.json();
                    console.log('‚úÖ Categories loaded from JSON:', categories);
                    console.log('üìä Categories count:', categories.length);

                    if (categories && Array.isArray(categories) && categories.length > 0) {
                        console.log('üé® Displaying categories...');
                        displayCategories(categories);
                    } else {
                        console.log('‚ö†Ô∏è Kategoriyalar JSON faylida yo\'q yoki bo\'sh');
                        grid.innerHTML = '<div class="col-span-full text-center text-yellow-400 py-8">‚ö†Ô∏è Kategoriyalar topilmadi</div>';
                    }
                } catch (error) {
                    console.error('‚ùå Error loading categories from JSON:', error);

                    // Show error message
                    grid.innerHTML = `
                        <div class="col-span-full text-center text-red-400 py-8">
                            <div class="text-xl mb-2">‚ùå Kategoriyalarni yuklashda xatolik</div>
                            <div class="text-sm text-gray-400">${error.message}</div>
                            <button onclick="loadCategories()" class="mt-4 bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">
                                üîÑ Qayta urinish
                            </button>
                        </div>
                    `;
                }
            }

            // Load categories with retry mechanism
            async function loadCategoriesWithRetry(maxRetries = 3, delay = 1000) {
                console.log(`üîÑ loadCategoriesWithRetry called (maxRetries: ${maxRetries})`);

                for (let attempt = 1; attempt <= maxRetries; attempt++) {
                    console.log(`üîÑ Attempt ${attempt}/${maxRetries}`);

                    try {
                        await loadCategories();

                        // Check if categories were loaded successfully
                        const grid = document.getElementById('categoriesGrid');
                        if (grid && !grid.innerHTML.includes('xatolik') && !grid.innerHTML.includes('yuklanmoqda')) {
                            console.log('‚úÖ Categories loaded successfully');
                            return;
                        }

                        if (attempt < maxRetries) {
                            console.log(`‚è≥ Waiting ${delay}ms before retry...`);
                            await new Promise(resolve => setTimeout(resolve, delay));
                            delay *= 2; // Exponential backoff
                        }
                    } catch (error) {
                        console.error(`‚ùå Attempt ${attempt} failed:`, error);
                        if (attempt < maxRetries) {
                            console.log(`‚è≥ Waiting ${delay}ms before retry...`);
                            await new Promise(resolve => setTimeout(resolve, delay));
                            delay *= 2; // Exponential backoff
                        }
                    }
                }

                console.error('‚ùå All retry attempts failed');
                const grid = document.getElementById('categoriesGrid');
                if (grid) {
                    grid.innerHTML = `
                        <div class="col-span-full text-center text-red-400 py-8">
                            <div class="text-xl mb-2">‚ùå Kategoriyalarni yuklashda xatolik</div>
                            <div class="text-sm text-gray-400 mb-4">Server bilan bog'lanishda muammo</div>
                            <button onclick="loadCategoriesWithRetry()" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">
                                üîÑ Qayta urinish
                            </button>
                        </div>
                    `;
                }
            }

            // Display categories
            function displayCategories(categories) {
                console.log('üé® displayCategories called with:', categories);
                const grid = document.getElementById('categoriesGrid');
                if (!grid) {
                    console.error('‚ùå categoriesGrid element not found in displayCategories!');
                    return;
                }
                console.log('‚úÖ Found categoriesGrid element');
                grid.innerHTML = '';

                if (!categories || !Array.isArray(categories) || categories.length === 0) {
                    console.log('‚ö†Ô∏è No categories to display');
                    grid.innerHTML = '<div class="col-span-full text-center text-gray-400 py-8">‚ö†Ô∏è Kategoriyalar topilmadi</div>';
                    return;
                }

                const categoryIcons = {
                    'hotdog': 'üå≠',
                    'burger': 'üçî',
                    'lavash': 'üåØ',
                    'sides': 'üçü',
                    'drinks': 'ü•§',
                    'combo': 'üéÅ',
                    'pizza': 'üçï'
                };

                const categoryNames = {
                    'hotdog': 'HotDog',
                    'burger': 'Burgerlar',
                    'lavash': 'Lavashlar',
                    'sides': 'Snacks',
                    'drinks': 'Ichimliklar',
                    'combo': 'Combo',
                    'pizza': 'Pizza'
                };

                const categoryColors = {
                    'hotdog': 'from-yellow-400 to-orange-500',
                    'burger': 'from-red-500 to-red-600',
                    'lavash': 'from-green-500 to-green-600',
                    'sides': 'from-amber-500 to-amber-600',
                    'drinks': 'from-blue-500 to-blue-600',
                    'combo': 'from-orange-500 to-red-500',
                    'pizza': 'from-red-600 to-orange-600'
                };

                // Show only first 3 categories initially
                const visibleCategories = categories.slice(0, 3);
                const hiddenCategories = categories.slice(3);

                // Display visible categories
                visibleCategories.forEach((category, index) => {
                    const categoryCard = document.createElement('div');
                    categoryCard.className = `category-card bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl p-6 hover:scale-105 transition-all duration-300 border border-gray-700 hover:border-orange-500 relative group cursor-pointer shadow-lg hover:shadow-xl`;
                    categoryCard.style.animationDelay = `${index * 100}ms`;
                    categoryCard.onclick = () => openCategoryPage(category.name);

                    categoryCard.innerHTML = `
                    <div class="text-center">
                        <!-- Icon -->
                        <div class="mb-4">
                            <div class="inline-flex items-center justify-center w-20 h-20 rounded-full bg-gradient-to-br ${categoryColors[category.name] || 'from-orange-500 to-red-500'} shadow-lg group-hover:shadow-2xl transition-all duration-300 group-hover:scale-110">
                                <span class="text-3xl">${categoryIcons[category.name] || 'üçΩÔ∏è'}</span>
                            </div>
                        </div>
                        
                        <!-- Title -->
                        <h3 class="text-xl font-bold mb-2 text-white group-hover:text-orange-400 transition-colors duration-300">
                            ${categoryNames[category.name] || category.name}
                        </h3>
                        
                        <!-- Description -->
                        <p class="text-gray-400 text-sm mb-4 leading-relaxed">
                            ${category.description}
                        </p>
                        
                        <!-- Button -->
                        <div class="inline-flex items-center justify-center px-4 py-2 rounded-full bg-gradient-to-r from-orange-500 to-red-600 text-white font-semibold text-sm shadow-lg group-hover:shadow-xl transition-all duration-300 group-hover:scale-105">
                            <span class="mr-2">Ko'rish</span>
                            <i class="fas fa-arrow-right group-hover:translate-x-1 transition-transform duration-300"></i>
                        </div>
                    </div>
                `;
                    grid.appendChild(categoryCard);
                });

                // Add hidden categories (initially hidden)
                hiddenCategories.forEach((category, index) => {
                    const categoryCard = document.createElement('div');
                    categoryCard.className = `category-card hidden bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl p-6 hover:scale-105 transition-all duration-300 border border-gray-700 hover:border-orange-500 relative group cursor-pointer shadow-lg hover:shadow-xl`;
                    categoryCard.style.animationDelay = `${(index + 3) * 100}ms`;
                    categoryCard.onclick = () => openCategoryPage(category.name);

                    categoryCard.innerHTML = `
                    <div class="text-center">
                        <!-- Icon -->
                        <div class="mb-4">
                            <div class="inline-flex items-center justify-center w-20 h-20 rounded-full bg-gradient-to-br ${categoryColors[category.name] || 'from-orange-500 to-red-500'} shadow-lg group-hover:shadow-2xl transition-all duration-300 group-hover:scale-110">
                                <span class="text-3xl">${categoryIcons[category.name] || 'üçΩÔ∏è'}</span>
                            </div>
                        </div>
                        
                        <!-- Title -->
                        <h3 class="text-xl font-bold mb-2 text-white group-hover:text-orange-400 transition-colors duration-300">
                            ${categoryNames[category.name] || category.name}
                        </h3>
                        
                        <!-- Description -->
                        <p class="text-gray-400 text-sm mb-4 leading-relaxed">
                            ${category.description}
                        </p>
                        
                        <!-- Button -->
                        <div class="inline-flex items-center justify-center px-4 py-2 rounded-full bg-gradient-to-r from-orange-500 to-red-600 text-white font-semibold text-sm shadow-lg group-hover:shadow-xl transition-all duration-300 group-hover:scale-105">
                            <span class="mr-2">Ko'rish</span>
                            <i class="fas fa-arrow-right group-hover:translate-x-1 transition-transform duration-300"></i>
                        </div>
                    </div>
                `;
                    grid.appendChild(categoryCard);
                });

                // Add "View All" button if there are hidden categories
                if (hiddenCategories.length > 0) {
                    const viewAllButton = document.createElement('div');
                    viewAllButton.className = 'col-span-full flex justify-center mt-8';
                    viewAllButton.innerHTML = `
                    <button onclick="showAllCategories()" class="bg-gradient-to-r from-orange-500 to-red-600 text-white px-8 py-4 rounded-full text-lg font-semibold hover:scale-105 transition duration-300 shadow-lg">
                        <i class="fas fa-eye mr-2"></i>Hammasini ko'rish
                    </button>
                `;
                    grid.appendChild(viewAllButton);
                }
            }

            // Show all categories function
            function showAllCategories() {
                const grid = document.getElementById('categoriesGrid');
                const hiddenCards = grid.querySelectorAll('.category-card.hidden');
                const viewAllButton = grid.querySelector('button[onclick="showAllCategories()"]');

                // Show all hidden category cards with animation
                hiddenCards.forEach((card, index) => {
                    setTimeout(() => {
                        card.classList.remove('hidden');
                        card.style.animation = 'fadeInUp 0.5s ease-out forwards';
                    }, index * 100);
                });

                // Replace the "View All" button with "Close" button
                if (viewAllButton) {
                    viewAllButton.parentElement.innerHTML = `
                        <button onclick="hideAllCategories()" class="bg-gradient-to-r from-gray-600 to-gray-700 text-white px-8 py-4 rounded-full text-lg font-semibold hover:scale-105 transition duration-300 shadow-lg">
                            <i class="fas fa-times mr-2"></i>Berkitish
                        </button>
                    `;
                }
            }

            // Hide all categories function
            function hideAllCategories() {
                const grid = document.getElementById('categoriesGrid');
                const allCards = grid.querySelectorAll('.category-card');
                const closeButton = grid.querySelector('button[onclick="hideAllCategories()"]');

                // Hide all categories except the first 3
                allCards.forEach((card, index) => {
                    if (index >= 3) {
                        card.classList.add('hidden');
                    }
                });

                // Replace the "Close" button with "View All" button
                if (closeButton) {
                    closeButton.parentElement.innerHTML = `
                        <button onclick="showAllCategories()" class="bg-gradient-to-r from-orange-500 to-red-600 text-white px-8 py-4 rounded-full text-lg font-semibold hover:scale-105 transition duration-300 shadow-lg">
                            <i class="fas fa-eye mr-2"></i>Hammasini ko'rish
                        </button>
                    `;
                }
            }

            // Update the DOMContentLoaded event
            document.addEventListener('DOMContentLoaded', async function () {
                console.log('üöÄ DOMContentLoaded event fired');

                // Load data from JSON file first
                await loadDataFromJSON();

                // Load trending products
                await loadTrendingProducts();

                // Load categories from JSON file with retry mechanism
                loadCategoriesWithRetry();

                // Load app data and update cart
                loadAppData();
                updateCartDisplay();
                updateCartUI();

                // Initialize Telegram Web App
                initializeTelegramWebApp();

                // Initialize real-time data synchronization
                initializeRealTimeSync();

                // Check if user is already logged in
                if (localStorage.getItem('userLoggedIn')) {
                    hideLoginSection();
                }


            });

            // Products data - Load from JSON file
            let products = [];
            let adminData = {};
            let vipData = {};
            let aboutData = {};

            // Load data from localStorage, sessionStorage, or JSON file
            async function loadDataFromJSON() {
                // First try to load from localStorage
                const localData = localStorage.getItem('popaysData');
                if (localData) {
                    try {
                        const data = JSON.parse(localData);
                        products = data.products || [];
                        adminData = data.admin || {};
                        vipData = data.vipSettings || {};
                        aboutData = data.aboutSettings || {};


                        console.log('Ma\'lumotlar localStorage dan yuklandi:', data);
                        return;
                    } catch (error) {
                        console.error('localStorage dan ma\'lumotlar yuklanmadi:', error);
                    }
                }

                // Then try sessionStorage
                const sessionData = sessionStorage.getItem('popaysData');
                if (sessionData) {
                    try {
                        const data = JSON.parse(sessionData);
                        products = data.products || [];
                        adminData = data.admin || {};
                        vipData = data.vipSettings || {};
                        aboutData = data.aboutSettings || {};


                        console.log('Ma\'lumotlar sessionStorage dan yuklandi:', data);
                        return;
                    } catch (error) {
                        console.error('sessionStorage dan ma\'lumotlar yuklanmadi:', error);
                    }
                }

                // Finally try to load from JSON file
                try {
                    const dbProducts = await loadProductsFromDatabase();
                    if (dbProducts && dbProducts.length > 0) {
                        products = dbProducts;
                    } else {
                        products = [];
                    }
                    adminData = {};
                    vipData = {};
                    aboutData = {};


                    console.log('Ma\'lumotlar JSON fayldan yuklandi:', products);

                    // Save to localStorage for future use
                    localStorage.setItem('popaysData', JSON.stringify({
                        products: products,
                        admin: adminData,
                        vipSettings: vipData,
                        aboutSettings: aboutData
                    }));

                } catch (error) {
                    console.error('JSON fayl yuklanmadi:', error);
                    // Fallback to default products if JSON fails
                    loadDefaultProducts();
                }
            }

            // Load default products if JSON fails


            let cart = [];
            let selectedBranch = null; // Store selected branch
            
            // Notification counter system
            let notificationCounter = {};
            let activeNotifications = {};

            // Real-time data synchronization
            let dataSyncInterval;
            let lastDataHash = '';

            function initializeRealTimeSync() {
                // Check for data updates every 5 seconds
                dataSyncInterval = setInterval(checkForDataUpdates, 5000);

                // Also check when user becomes active
                document.addEventListener('visibilitychange', () => {
                    if (!document.hidden) {
                        checkForDataUpdates();
                    }
                });
            }

            function checkForDataUpdates() {
                const currentDataHash = generateDataHash();
                if (currentDataHash !== lastDataHash) {
                    lastDataHash = currentDataHash;
                    refreshUserInterface();
                    showDataUpdateNotification();
                }
            }

            function generateDataHash() {
                const data = {
                    products: products,
                    admin: adminData,
                    vip: vipData,
                    about: aboutData
                };
                return JSON.stringify(data);
            }

            function refreshUserInterface() {
                // Products are now shown only in category modals

                // Update cart if needed
                updateCartUI();

                // Update VIP section
                updateVipSection();

                // Update about section
                updateAboutSection();
            }

            function showDataUpdateNotification() {
                // Menu updated silently without notification
                // No notification shown to user
            }

            function renderProducts() {
                // Products are now shown only in category modals, not on main page
                console.log('Products loaded:', products.length);
            }

            function updateVipSection() {
                if (vipData.title) {
                    const vipTitle = document.getElementById('vipSectionTitle');
                    const vipDiscount = document.getElementById('vipDiscountText');
                    const vipMinOrder = document.getElementById('vipMinOrderText');

                    if (vipTitle) vipTitle.textContent = vipData.title;
                    if (vipDiscount) vipDiscount.textContent = vipData.discount;
                    if (vipMinOrder) vipMinOrder.textContent = vipData.minOrder;
                }
            }

            function updateAboutSection() {
                if (aboutData.advantage1) {
                    const advantage1 = document.getElementById('aboutAdvantage1Text');
                    const advantage2 = document.getElementById('aboutAdvantage2Text');
                    const advantage3 = document.getElementById('aboutAdvantage3Text');
                    const advantage4 = document.getElementById('aboutAdvantage4Text');

                    if (advantage1) advantage1.textContent = aboutData.advantage1;
                    if (advantage2) advantage2.textContent = aboutData.advantage2;
                    if (advantage3) advantage3.textContent = aboutData.advantage3;
                    if (advantage4) advantage4.textContent = aboutData.advantage4;
                }
            }

            // Handle admin login form submission


            // Handle custom location input
            const customLocation = document.getElementById('customLocation');
            if (customLocation) {
                customLocation.addEventListener('input', handleCustomLocation);
            }

            // Handle custom location input for checkout
            const checkoutCustomLocation = document.getElementById('checkoutCustomLocation');
            if (checkoutCustomLocation) {
                checkoutCustomLocation.addEventListener('input', handleCheckoutCustomLocation);
            }

            // Handle custom location input for cart
            const cartCustomLocation = document.getElementById('cartCustomLocation');
            if (cartCustomLocation) {
                cartCustomLocation.addEventListener('input', handleCartCustomLocation);
            }

            // Handle contact form submission
            const contactForm = document.getElementById('contactForm');
            if (contactForm) {
                contactForm.addEventListener('submit', handleContactForm);
            }

            // Remove error states when user starts typing
            const userName = document.getElementById('userName');
            if (userName) {
                userName.addEventListener('input', function () {
                    this.classList.remove('border-red-500');
                });
            }

            const userPhone = document.getElementById('userPhone');
            if (userPhone) {
                userPhone.addEventListener('input', function () {
                    this.classList.remove('border-red-500');
                });
            }

            // Remove error states in contact form when user starts typing
            const contactName = document.getElementById('contactName');
            if (contactName) {
                contactName.addEventListener('input', function () {
                    this.classList.remove('border-red-500');
                });
            }

            const contactPhone = document.getElementById('contactPhone');
            if (contactPhone) {
                contactPhone.addEventListener('input', function () {
                    this.classList.remove('border-red-500');
                });
            }

            const contactMessage = document.getElementById('contactMessage');
            if (contactMessage) {
                contactMessage.addEventListener('input', function () {
                    this.classList.remove('border-red-500');
                });
            }

            // Customer info form submission removed - now handled in cart modal

            // Handle login
            function handleLogin(e) {
                e.preventDefault();

                const userName = document.getElementById('userName').value.trim();
                const userPhone = document.getElementById('userPhone').value.trim();
                const userLocation = document.getElementById('userLocation').value.trim();

                // Reset error states
                document.getElementById('userName').classList.remove('border-red-500');
                document.getElementById('userPhone').classList.remove('border-red-500');

                let hasError = false;

                // Check if all fields are filled
                if (!userName) {
                    showNotification('Iltimos, ismingizni kiriting!', 'error');
                    document.getElementById('userName').classList.add('border-red-500');
                    document.getElementById('userName').focus();
                    hasError = true;
                }

                if (!userPhone) {
                    showNotification('Iltimos, telefon raqamingizni kiriting!', 'error');
                    document.getElementById('userPhone').classList.add('border-red-500');
                    if (!hasError) document.getElementById('userPhone').focus();
                    hasError = true;
                }

                if (!userLocation) {
                    showNotification('Iltimos, lokatsiyani aniqlang yoki manzilingizni kiriting!', 'error');
                    hasError = true;
                }

                // Check if location is properly set (not just placeholder text)
                if (userLocation === 'Lokatsiyani aniqlang yoki kiriting' || userLocation === '') {
                    showNotification('Iltimos, lokatsiyani aniqlang yoki aniq manzilingizni kiriting!', 'error');
                    hasError = true;
                }

                if (hasError) {
                    return;
                }

                // Save user info to localStorage
                localStorage.setItem('userName', userName);
                localStorage.setItem('userPhone', userPhone);
                localStorage.setItem('userLocation', userLocation);
                localStorage.setItem('userLoggedIn', 'true');

                // Save user to registered users list
                const userData = {
                    name: userName,
                    phone: userPhone,
                    location: userLocation,
                    timestamp: new Date().toISOString()
                };

                const existingUsers = JSON.parse(localStorage.getItem('registeredUsers')) || [];
                const userExists = existingUsers.find(user => user.phone === userPhone);

                if (!userExists) {
                    existingUsers.push(userData);
                    localStorage.setItem('registeredUsers', JSON.stringify(existingUsers));

                    // Save all data to JSON structure
                    saveAllDataToJSON();
                }

                // Hide login modal
                toggleLogin();

                // Hide login section
                hideLoginSection();

                // Show welcome message
                showNotification(`Xush kelibsiz, ${userName}! üéâ`);
            }

            // Toggle login modal
            function toggleLogin() {
                const modal = document.getElementById('loginModal');
                modal.classList.toggle('hidden');

                // Reset location selection when opening modal
                if (!modal.classList.contains('hidden')) {
                    resetLocationSelection();
                }
            }

            // Detect location for checkout
            function detectLocationForCheckout() {
                if (!navigator.geolocation) {
                    document.getElementById('checkoutLocationStatus').innerHTML = 'Geolocation qo\'llab-quvvatlanmaydi';
                    return;
                }

                document.getElementById('checkoutLocationStatus').innerHTML = 'Lokatsiya aniqlanmoqda...';

                navigator.geolocation.getCurrentPosition(
                    function (position) {
                        const latitude = position.coords.latitude;
                        const longitude = position.coords.longitude;
                        const accuracy = position.coords.accuracy;

                        // Store coordinates globally
                        window.userCoordinates = { latitude, longitude, accuracy };

                        // Get address from coordinates
                        getAddressFromCoordinatesForCheckout(latitude, longitude);

                        // Show map
                        showLocationMapForCheckout(latitude, longitude);

                        document.getElementById('checkoutLocationStatus').innerHTML = 'Lokatsiya muvaffaqiyatli aniqlandi!';
                    },
                    function (error) {
                        let errorMessage = 'Lokatsiya aniqlanmadi: ';
                        switch (error.code) {
                            case error.PERMISSION_DENIED:
                                errorMessage += 'Ruxsat berilmadi';
                                break;
                            case error.POSITION_UNAVAILABLE:
                                errorMessage += 'Lokatsiya mavjud emas';
                                break;
                            case error.TIMEOUT:
                                errorMessage += 'Vaqt tugadi';
                                break;
                            default:
                                errorMessage += 'Noma\'lum xatolik';
                                break;
                        }
                        document.getElementById('checkoutLocationStatus').innerHTML = errorMessage;
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 60000
                    }
                );
            }

            // Get address from coordinates for checkout
            function getAddressFromCoordinatesForCheckout(latitude, longitude) {
                const apiKey = 'YOUR_API_KEY'; // Replace with your actual API key
                const url = `https://geocode-maps.yandex.ru/1.x/?apikey=${apiKey}&format=json&geocode=${longitude},${latitude}&results=1`;

                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        if (data.response && data.response.GeoObjectCollection && data.response.GeoObjectCollection.featureMember && data.response.GeoObjectCollection.featureMember.length > 0) {
                            const address = data.response.GeoObjectCollection.featureMember[0].GeoObject.metaDataProperty.GeocoderMetaData.text;
                            document.getElementById('checkoutSelectedLocationText').textContent = address;
                            document.getElementById('checkoutCustomerLocation').value = address;
                        } else {
                            document.getElementById('checkoutSelectedLocationText').textContent = `Koordinatalar: ${latitude.toFixed(6)}, ${longitude.toFixed(6)}`;
                            document.getElementById('checkoutCustomerLocation').value = `Koordinatalar: ${latitude.toFixed(6)}, ${longitude.toFixed(6)}`;
                        }
                    })
                    .catch(error => {
                        console.error('Address fetch error:', error);
                        document.getElementById('checkoutSelectedLocationText').textContent = `Koordinatalar: ${latitude.toFixed(6)}, ${longitude.toFixed(6)}`;
                        document.getElementById('checkoutCustomerLocation').value = `Koordinatalar: ${latitude.toFixed(6)}, ${longitude.toFixed(6)}`;
                    });
            }

            // Show location map for checkout
            function showLocationMapForCheckout(latitude, longitude) {
                const mapContainer = document.getElementById('checkoutLocationMapContainer');
                const mapElement = document.getElementById('checkoutLocationMap');
                const coordinatesElement = document.getElementById('checkoutLocationCoordinates');
                const accuracyElement = document.getElementById('checkoutLocationAccuracy');

                // Show coordinates and accuracy
                coordinatesElement.textContent = `${latitude.toFixed(6)}, ${longitude.toFixed(6)}`;
                accuracyElement.textContent = `¬±${Math.round(window.userCoordinates.accuracy)}m`;

                // Show map container
                mapContainer.classList.remove('hidden');

                // Create map using Yandex Maps
                if (typeof ymaps !== 'undefined') {
                    ymaps.ready(function () {
                        const map = new ymaps.Map(mapElement, {
                            center: [latitude, longitude],
                            zoom: 16
                        });

                        const placemark = new ymaps.Placemark([latitude, longitude], {
                            balloonContent: 'Sizning joylashuvingiz'
                        }, {
                            preset: 'islands#redDotIcon'
                        });

                        map.geoObjects.add(placemark);
                    });
                } else {
                    // Fallback: show coordinates if Yandex Maps is not available
                    mapElement.innerHTML = `
                    <div class="absolute inset-0 flex items-center justify-center text-gray-400">
                        <div class="text-center">
                            <i class="fas fa-map-marker-alt text-2xl mb-2"></i>
                            <div>Lat: ${latitude.toFixed(6)}</div>
                            <div>Lng: ${longitude.toFixed(6)}</div>
                        </div>
                    </div>
                `;
                }
            }

            // Show location on external map for checkout
            function showLocationOnMapForCheckout() {
                if (window.userCoordinates) {
                    const { latitude, longitude } = window.userCoordinates;
                    const googleMapsUrl = `https://www.google.com/maps?q=${latitude},${longitude}`;
                    window.open(googleMapsUrl, '_blank');
                }
            }

            // Detect location for cart
            function detectLocationForCart() {
                if (!navigator.geolocation) {
                    document.getElementById('cartLocationStatus').innerHTML = 'Geolocation qo\'llab-quvvatlanmaydi';
                    return;
                }

                document.getElementById('cartLocationStatus').innerHTML = 'Lokatsiya aniqlanmoqda...';

                navigator.geolocation.getCurrentPosition(
                    function (position) {
                        const latitude = position.coords.latitude;
                        const longitude = position.coords.longitude;
                        const accuracy = position.coords.accuracy;

                        // Store coordinates globally
                        window.userCoordinates = { latitude, longitude, accuracy };

                        // Get address from coordinates
                        getAddressFromCoordinatesForCart(latitude, longitude);

                        document.getElementById('cartLocationStatus').innerHTML = 'Lokatsiya muvaffaqiyatli aniqlandi!';
                    },
                    function (error) {
                        let errorMessage = 'Lokatsiya aniqlanmadi: ';
                        switch (error.code) {
                            case error.PERMISSION_DENIED:
                                errorMessage += 'Ruxsat berilmadi';
                                break;
                            case error.POSITION_UNAVAILABLE:
                                errorMessage += 'Lokatsiya mavjud emas';
                                break;
                            case error.TIMEOUT:
                                errorMessage += 'Vaqt tugadi';
                                break;
                            default:
                                errorMessage += 'Noma\'lum xatolik';
                                break;
                        }
                        document.getElementById('cartLocationStatus').innerHTML = errorMessage;
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 60000
                    }
                );
            }

            // Get address from coordinates for cart
            function getAddressFromCoordinatesForCart(latitude, longitude) {
                const apiKey = 'YOUR_API_KEY'; // Replace with your actual API key
                const url = `https://geocode-maps.yandex.ru/1.x/?apikey=${apiKey}&format=json&geocode=${longitude},${latitude}&results=1`;

                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        if (data.response && data.response.GeoObjectCollection && data.response.GeoObjectCollection.featureMember && data.response.GeoObjectCollection.featureMember.length > 0) {
                            const address = data.response.GeoObjectCollection.featureMember[0].GeoObject.metaDataProperty.GeocoderMetaData.text;
                            document.getElementById('cartSelectedLocationText').textContent = address;
                            document.getElementById('cartCustomerLocation').value = address;
                        } else {
                            document.getElementById('cartSelectedLocationText').textContent = `Koordinatalar: ${latitude.toFixed(6)}, ${longitude.toFixed(6)}`;
                            document.getElementById('cartCustomerLocation').value = `Koordinatalar: ${latitude.toFixed(6)}, ${longitude.toFixed(6)}`;
                        }
                    })
                    .catch(error => {
                        console.error('Address fetch error:', error);
                        document.getElementById('cartSelectedLocationText').textContent = `Koordinatalar: ${latitude.toFixed(6)}, ${longitude.toFixed(6)}`;
                        document.getElementById('cartCustomerLocation').value = `Koordinatalar: ${latitude.toFixed(6)}, ${longitude.toFixed(6)}`;
                    });
            }

            // Detect user location using geolocation API
            function detectLocation() {
                const statusElement = document.getElementById('locationStatus');
                const locationButton = document.querySelector('button[onclick="detectLocation()"]');

                // Update status and disable button
                statusElement.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Lokatsiya aniqlanmoqda...';
                locationButton.disabled = true;
                locationButton.classList.add('opacity-50');

                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        // Success callback
                        function (position) {
                            const latitude = position.coords.latitude;
                            const longitude = position.coords.longitude;
                            const accuracy = position.coords.accuracy;

                            // Store coordinates globally for map display
                            window.userCoordinates = {
                                latitude: latitude,
                                longitude: longitude,
                                accuracy: accuracy
                            };

                            // Get address from coordinates using reverse geocoding
                            getAddressFromCoordinates(latitude, longitude, accuracy);
                        },
                        // Error callback
                        function (error) {
                            let errorMessage = 'Lokatsiya aniqlanmadi';
                            switch (error.code) {
                                case error.PERMISSION_DENIED:
                                    errorMessage = 'Lokatsiya ruxsati berilmadi';
                                    break;
                                case error.POSITION_UNAVAILABLE:
                                    errorMessage = 'Lokatsiya ma\'lumoti mavjud emas';
                                    break;
                                case error.TIMEOUT:
                                    errorMessage = 'Lokatsiya aniqlash vaqti tugadi';
                                    break;
                            }

                            statusElement.innerHTML = `<i class="fas fa-exclamation-triangle text-red-400 mr-2"></i>${errorMessage}`;
                            locationButton.disabled = false;
                            locationButton.classList.remove('opacity-50');
                        },
                        // Options
                        {
                            enableHighAccuracy: true,
                            timeout: 10000,
                            maximumAge: 60000
                        }
                    );
                } else {
                    statusElement.innerHTML = '<i class="fas fa-exclamation-triangle text-red-400 mr-2"></i>Brauzeringiz lokatsiyani qo\'llab-quvvatlamaydi';
                    locationButton.disabled = false;
                    locationButton.classList.remove('opacity-50');
                }
            }

            // Get address from coordinates using reverse geocoding
            function getAddressFromCoordinates(latitude, longitude, accuracy) {
                const statusElement = document.getElementById('locationStatus');

                // Use OpenStreetMap Nominatim API for reverse geocoding
                const url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}&zoom=18&addressdetails=1`;

                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        if (data.display_name) {
                            // Extract relevant address parts
                            const address = data.display_name;
                            const city = data.address?.city || data.address?.town || data.address?.village || 'Noma\'lum shahar';
                            const street = data.address?.road || data.address?.street || 'Noma\'lum ko\'cha';
                            const houseNumber = data.address?.house_number || '';

                            // Create a formatted address
                            let formattedAddress = `${city}, ${street}`;
                            if (houseNumber) {
                                formattedAddress += `, ${houseNumber}-uy`;
                            }

                            // Update UI
                            document.getElementById('userLocation').value = formattedAddress;
                            document.getElementById('selectedLocationText').textContent = formattedAddress;
                            statusElement.innerHTML = '<i class="fas fa-check-circle text-green-400 mr-2"></i>Lokatsiya muvaffaqiyatli aniqlandi!';

                            // Clear custom location input
                            document.getElementById('customLocation').value = '';

                            // Show success notification
                            showNotification('Lokatsiya muvaffaqiyatli aniqlandi! üìç');

                            // Show map with location
                            showLocationMap(latitude, longitude, accuracy, formattedAddress);
                        } else {
                            throw new Error('Manzil ma\'lumoti topilmadi');
                        }
                    })
                    .catch(error => {
                        console.error('Error getting address:', error);
                        // Fallback: use coordinates if address lookup fails
                        const fallbackAddress = `Koordinatalar: ${latitude.toFixed(6)}, ${longitude.toFixed(6)}`;
                        document.getElementById('userLocation').value = fallbackAddress;
                        document.getElementById('selectedLocationText').textContent = fallbackAddress;
                        statusElement.innerHTML = '<i class="fas fa-info-circle text-blue-400 mr-2"></i>Koordinatalar saqlandi';

                        // Show map with coordinates
                        showLocationMap(latitude, longitude, accuracy, fallbackAddress);

                        showNotification('Lokatsiya koordinatalari saqlandi! üìç');
                    })
                    .finally(() => {
                        const locationButton = document.querySelector('button[onclick="detectLocation()"]');
                        locationButton.disabled = false;
                        locationButton.classList.remove('opacity-50');
                    });
            }

            // Show location on map
            function showLocationMap(latitude, longitude, accuracy, address) {
                const mapContainer = document.getElementById('locationMapContainer');
                const mapDiv = document.getElementById('locationMap');
                const coordinatesSpan = document.getElementById('locationCoordinates');
                const accuracySpan = document.getElementById('locationAccuracy');

                // Show map container
                mapContainer.classList.remove('hidden');

                // Update coordinates and accuracy display
                coordinatesSpan.textContent = `${latitude.toFixed(6)}, ${longitude.toFixed(6)}`;
                accuracySpan.textContent = `Aniqlik: ¬±${Math.round(accuracy)}m`;

                // Clear loading message
                mapDiv.innerHTML = '';

                // Initialize map if not already done
                if (!window.locationMap) {
                    try {
                        // Wait for Yandex Maps API to load
                        if (typeof ymaps === 'undefined') {
                            setTimeout(() => showLocationMap(latitude, longitude, accuracy, address), 100);
                            return;
                        }

                        // Create Yandex Map
                        window.locationMap = new ymaps.Map(mapDiv, {
                            center: [latitude, longitude],
                            zoom: 16,
                            controls: ['zoomControl', 'fullscreenControl']
                        });

                        // Add custom marker
                        const customMarker = new ymaps.Placemark([latitude, longitude], {
                            balloonContent: `
                            <div style="text-align: center;">
                                <strong style="color: #f97316;">üìç Sizning lokatsiyangiz</strong><br>
                                <small style="color: #6b7280;">${address}</small>
                            </div>
                        `
                        }, {
                            preset: 'islands#orangeDotIcon',
                            iconColor: '#f97316'
                        });

                        // Add marker to map
                        window.locationMap.geoObjects.add(customMarker);

                        // Fit map to marker
                        window.locationMap.setBounds(customMarker.geometry.getBounds(), {
                            checkZoomRange: true
                        });

                        console.log('Yandex xarita muvaffaqiyatli yaratildi');

                    } catch (error) {
                        console.error('Yandex xarita yaratishda xatolik:', error);
                        mapDiv.innerHTML = `
                        <div class="flex items-center justify-center h-full text-red-400">
                            <i class="fas fa-exclamation-triangle text-xl mr-2"></i>
                            <span>Yandex xarita yaratishda xatolik yuz berdi</span>
                        </span>
                    `;
                    }

                } else {
                    // Update existing map
                    try {
                        window.locationMap.setCenter([latitude, longitude]);
                        window.locationMap.setZoom(16);

                        // Update marker position
                        window.locationMap.geoObjects.each((geoObject) => {
                            if (geoObject instanceof ymaps.Placemark) {
                                geoObject.geometry.setCoordinates([latitude, longitude]);
                                geoObject.properties.set('balloonContent', `
                                <div style="text-align: center;">
                                    <strong style="color: #f97316;">üìç Sizning lokatsiyangiz</strong><br>
                                    <small style="color: #6b7280;">${address}</small>
                                </div>
                            `);
                            }
                        });
                    } catch (error) {
                        console.error('Yandex xaritani yangilashda xatolik:', error);
                    }
                }
            }

            // Show location on external map
            function showLocationOnMap() {
                if (window.userCoordinates) {
                    const { latitude, longitude } = window.userCoordinates;
                    const url = `https://yandex.uz/maps/?pt=${longitude},${latitude}&z=15&l=map`;
                    window.open(url, '_blank');
                }
            }

            // Handle custom location input
            function handleCustomLocation() {
                const customLocation = document.getElementById('customLocation').value.trim();
                if (customLocation) {
                    // Reset location status
                    document.getElementById('locationStatus').innerHTML = '<i class="fas fa-edit text-blue-400 mr-2"></i>Maxsus manzil kiritildi';

                    // Update hidden input and display text
                    document.getElementById('userLocation').value = customLocation;
                    document.getElementById('selectedLocationText').textContent = customLocation;
                } else {
                    // Clear location if input is empty
                    document.getElementById('userLocation').value = '';
                    document.getElementById('selectedLocationText').textContent = 'Lokatsiyani aniqlang yoki kiriting';
                    document.getElementById('locationStatus').innerHTML = 'Lokatsiyani aniqlash uchun tugmani bosing';
                }
            }

            function handleCheckoutCustomLocation() {
                const customLocation = document.getElementById('checkoutCustomLocation').value.trim();
                if (customLocation) {
                    // Reset location status
                    document.getElementById('checkoutLocationStatus').innerHTML = '<i class="fas fa-edit text-blue-400 mr-2"></i>Maxsus manzil kiritildi';

                    // Update hidden input and display text
                    document.getElementById('checkoutCustomerLocation').value = customLocation;
                    document.getElementById('checkoutSelectedLocationText').textContent = customLocation;
                } else {
                    // Clear location if input is empty
                    document.getElementById('checkoutCustomerLocation').value = '';
                    document.getElementById('checkoutSelectedLocationText').textContent = 'Lokatsiyani aniqlang yoki kiriting';
                    document.getElementById('checkoutLocationStatus').innerHTML = 'Lokatsiyani aniqlash uchun tugmani bosing';
                }
            }

            function handleCartCustomLocation() {
                const customLocation = document.getElementById('cartCustomLocation').value.trim();
                if (customLocation) {
                    // Reset location status
                    document.getElementById('cartLocationStatus').innerHTML = '<i class="fas fa-edit text-blue-400 mr-2"></i>Maxsus manzil kiritildi';

                    // Update hidden input and display text
                    document.getElementById('cartCustomerLocation').value = customLocation;
                    document.getElementById('cartSelectedLocationText').textContent = customLocation;
                } else {
                    // Clear location if input is empty
                    document.getElementById('cartCustomerLocation').value = '';
                    document.getElementById('cartSelectedLocationText').textContent = 'Lokatsiyani aniqlang yoki kiriting';
                    document.getElementById('cartLocationStatus').innerHTML = 'Lokatsiyani aniqlash uchun tugmani bosing';
                }
            }

            // Reset location selection
            function resetLocationSelection() {
                document.getElementById('userLocation').value = '';
                document.getElementById('customLocation').value = '';
                document.getElementById('selectedLocationText').textContent = 'Lokatsiyani aniqlang yoki kiriting';
                document.getElementById('locationStatus').innerHTML = 'Lokatsiyani aniqlash uchun tugmani bosing';

                // Hide map container
                document.getElementById('locationMapContainer').classList.add('hidden');

                // Clear stored coordinates
                window.userCoordinates = null;

                // Clear any error states
                document.getElementById('userName').classList.remove('border-red-500');
                document.getElementById('userPhone').classList.remove('border-red-500');
            }

            // Hide login section
            function hideLoginSection() {
                // Hide desktop login button
                const loginBtn = document.getElementById('loginBtn');
                if (loginBtn) {
                    loginBtn.classList.add('hidden');
                }

                // Show desktop logout button
                const logoutBtn = document.getElementById('logoutBtn');
                if (logoutBtn) {
                    logoutBtn.classList.remove('hidden');
                }

                // Hide mobile login button
                const mobileLoginBtn = document.getElementById('mobileLoginBtn');
                if (mobileLoginBtn) {
                    mobileLoginBtn.classList.add('hidden');
                }

                // Show mobile logout button
                const mobileLogoutBtn = document.getElementById('mobileLogoutBtn');
                if (mobileLogoutBtn) {
                    mobileLogoutBtn.classList.remove('hidden');
                }
            }

            // Logout function
            function logout() {
                // Clear user data
                localStorage.removeItem('userName');
                localStorage.removeItem('userPhone');
                localStorage.removeItem('userLocation');
                localStorage.removeItem('userLoggedIn');

                // Clear cart
                cart = [];
                updateCartUI();

                // Show desktop login button
                const loginBtn = document.getElementById('loginBtn');
                if (loginBtn) {
                    loginBtn.classList.remove('hidden');
                }

                // Hide desktop logout button
                const logoutBtn = document.getElementById('logoutBtn');
                if (logoutBtn) {
                    logoutBtn.classList.add('hidden');
                }

                // Show mobile login button
                const mobileLoginBtn = document.getElementById('mobileLoginBtn');
                if (mobileLoginBtn) {
                    mobileLoginBtn.classList.remove('hidden');
                }

                // Hide mobile logout button
                const mobileLogoutBtn = document.getElementById('mobileLogoutBtn');
                if (mobileLogoutBtn) {
                    mobileLogoutBtn.classList.add('hidden');
                }

                showNotification('Tizimdan chiqildi! üëã');
            }



            // Open category page
            function openCategoryPage(category) {
                // Create category page content
                const categoryNames = {
                    'hotdog': 'HotDog',
                    'burger': 'Burgerlar',
                    'lavash': 'Lavashlar',
                    'sides': 'Snacks',
                    'drinks': 'Ichimliklar',
                    'combo': 'Combo',
                    'pizza': 'Pizza'
                };

                const categoryName = categoryNames[category];
                const filteredProducts = products.filter(p => p.category === category);

                // Create modal for category products
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4';
                modal.innerHTML = `
                <div class="bg-gradient-to-br from-gray-900 to-gray-800 rounded-3xl p-8 max-w-6xl w-full max-h-[90vh] overflow-y-auto border border-orange-500/30 slide-in">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-3xl font-bold bg-gradient-to-r from-orange-400 to-red-500 bg-clip-text text-transparent">
                            ${categoryName}
                        </h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-white text-2xl">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6" data-product-container data-category="all">
                                                 ${filteredProducts.map(product => {
                    const isOutOfStock = product.stock === 0;
                    const isLowStock = product.stock > 0 && product.stock <= 3;
                    const stockMessage = isOutOfStock ? 'Mahsulot tugadi' : (isLowStock ? `Qoldi: ${product.stock} ta` : '');
                    const hasSizes = product.sizes && product.sizes.length > 0;
                    

                    return `
                             <div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl p-6 transition duration-300 border border-gray-700 ${isOutOfStock ? 'opacity-60' : 'hover:scale-105 hover:border-orange-500'} relative group">
                                 ${product.badge ? `<span class="absolute top-2 right-2 bg-gradient-to-r from-red-500 to-orange-500 text-xs px-3 py-1 rounded-full font-bold">${product.badge}</span>` : ''}
                                 <div class="mb-4 text-center ${isOutOfStock ? '' : 'group-hover:scale-110'} transition duration-300">
                                     <img src="${product.image}" alt="${product.name}" class="w-24 h-24 object-cover rounded-lg mx-auto ${isOutOfStock ? 'grayscale' : ''}">
                                     ${isOutOfStock ? '<div class="absolute inset-0 bg-black/50 rounded-lg flex items-center justify-center"><span class="bg-red-600 text-white px-2 py-1 rounded-full text-xs font-bold">TUGADI</span></div>' : ''}
                                 </div>
                                 <h3 class="text-lg font-bold mb-2">${product.name}</h3>
                                 <p class="text-gray-400 text-sm mb-3">${product.description}</p>
                                 ${stockMessage ? `<p class="text-yellow-400 text-sm mb-2 font-medium">${stockMessage}</p>` : ''}
                                 ${hasSizes ? `<p class="text-blue-400 text-sm mb-2 font-medium">${product.category === 'drinks' ? 'Litrini tanlang' : (product.category === 'pizza' ? 'Santimetrini tanlang' : 'Grammini tanlang')}</p>` : ''}
                                 <div class="flex justify-between items-center">
                                     <span class="text-xl font-bold text-orange-400">${hasSizes ? `${product.sizes[0].price.toLocaleString()} so'mdan` : `${product.price.toLocaleString()} so'm`}</span>
                                 </div>
                                 <button ${isOutOfStock ? 'disabled' : `onclick="${hasSizes ? `showSizeModal(${product.id})` : `addToCart(${product.id})`}"`} class="w-full mt-4 bg-gradient-to-r ${isOutOfStock ? 'from-gray-500 to-gray-600 cursor-not-allowed' : 'from-orange-500 to-red-600 hover:scale-105'} py-2 rounded-full transition duration-300">
                                     <i class="fas ${isOutOfStock ? 'fa-times mr-2' : (hasSizes ? 'fa-list mr-2' : 'fa-cart-plus mr-2')}"></i>${isOutOfStock ? 'Tugadi' : (hasSizes ? (product.category === 'drinks' ? 'Litrini tanlang' : (product.category === 'pizza' ? 'Santimetrini tanlang' : 'Grammini tanlang')) : 'Qo\'shish')}
                                 </button>
                             </div>
                         `;
                }).join('')}
                    </div>
                </div>
            `;

                document.body.appendChild(modal);
            }

            // Show size selection modal
            function showSizeModal(productId) {
                const product = products.find(p => p.id === productId);
                if (!product || !product.sizes) return;

                // Determine if it's drinks (liters), pizza (centimeters), or sides (grams)
                const isDrink = product.category === 'drinks';
                const isPizza = product.category === 'pizza';
                const sizeLabel = isDrink ? 'Litrini tanlang:' : (isPizza ? 'Santimetrini tanlang:' : 'Grammini tanlang:');

                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4';
                modal.innerHTML = `
                <div class="bg-gradient-to-br from-gray-900 to-gray-800 rounded-3xl p-8 max-w-md w-full border border-orange-500/30 slide-in">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold bg-gradient-to-r from-orange-400 to-red-500 bg-clip-text text-transparent">
                            ${product.name}
                        </h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-white text-2xl">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="mb-6">
                        <img src="${product.image}" alt="${product.name}" class="w-32 h-32 object-cover rounded-lg mx-auto mb-4">
                        <p class="text-gray-400 text-center mb-4">${product.description}</p>
                        <p class="text-yellow-400 text-center font-medium">${sizeLabel}</p>
                    </div>
                    <div class="space-y-3 mb-6">
                        ${product.sizes.map(size => `
                            <button onclick="addToCartWithSize(${productId}, '${size.size}', ${size.price}); this.closest('.fixed').remove();" 
                                    class="w-full bg-gradient-to-r from-gray-700 to-gray-600 hover:from-orange-500 hover:to-red-600 text-white py-3 px-4 rounded-lg transition duration-300 flex justify-between items-center">
                                <span class="font-semibold">${size.size}</span>
                                <span class="font-bold">${size.price.toLocaleString()} so'm</span>
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
                document.body.appendChild(modal);
            }

            // Add to cart with specific size
            function addToCartWithSize(productId, size, price) {
                const product = products.find(p => p.id === productId);
                if (!product) return;

                // Check if product is out of stock
                if (product.stock === 0) {
                    showNotification('Bu mahsulot tugagan!', 'error');
                    return;
                }

                // Branch selection is not required for adding products to cart

                // Allow ordering combo and pizza from any branch

                const productWithSize = {
                    ...product,
                    price: price,
                    selectedSize: size,
                    name: `${product.name} (${size})`
                };

                const existingItem = cart.find(item => item.id === productId && item.selectedSize === size);

                if (existingItem) {
                    // Check if adding one more would exceed stock
                    if (existingItem.quantity >= product.stock) {
                        showNotification(`Faqat ${product.stock} ta qoldi!`, 'warning');
                        return;
                    }
                    existingItem.quantity++;
                } else {
                    cart.push({ ...productWithSize, quantity: 1 });
                }

                updateCartUI();
                showNotification(`${product.name} (${size}) savatga qo'shildi!`);
            }

            // Add to cart
            function addToCart(productId) {
                const product = products.find(p => p.id === productId);

                // Check if product is out of stock
                if (product.stock === 0) {
                    showNotification('Bu mahsulot tugagan!', 'error');
                    return;
                }

                // Branch selection is not required for adding products to cart

                // Allow ordering combo and pizza from any branch

                const existingItem = cart.find(item => item.id === productId);

                if (existingItem) {
                    // Check if adding one more would exceed stock
                    if (existingItem.quantity >= product.stock) {
                        showNotification(`Faqat ${product.stock} ta qoldi!`, 'warning');
                        return;
                    }
                    existingItem.quantity++;
                } else {
                    cart.push({ ...product, quantity: 1 });
                }

                updateCartUI();
                showNotification('Mahsulot savatga qo\'shildi!');
            }

            // Remove from cart
            function removeFromCart(productId) {
                cart = cart.filter(item => item.id !== productId);
                updateCartUI();
            }

            // Update quantity
            function updateQuantity(productId, change) {
                const item = cart.find(item => item.id === productId);
                if (item) {
                    item.quantity += change;
                    if (item.quantity <= 0) {
                        removeFromCart(productId);
                    } else {
                        updateCartUI();
                    }
                }
            }

            // Branch selection function
            function selectBranch(branch) {
                selectedBranch = branch;

                // Reset all branch buttons
                document.querySelectorAll('.branch-btn').forEach(btn => {
                    btn.classList.remove('border-orange-400', 'scale-105');
                    btn.classList.add('border-transparent');
                });

                // Highlight selected branch
                const selectedBtn = document.getElementById(`branch${branch.charAt(0).toUpperCase() + branch.slice(1)}`);
                if (selectedBtn) {
                    selectedBtn.classList.remove('border-transparent');
                    selectedBtn.classList.add('border-orange-400', 'scale-105');
                }

                // Hide error message
                document.getElementById('branchSelectionError').classList.add('hidden');

                // All products are available from all branches now

                // Branch selection notification removed
                
                // Products are now shown only in category modals
            }

            // Update cart UI
            function updateCartUI() {
                const cartCount = document.getElementById('cartCount');
                const mobileCartCount = document.getElementById('mobileCartCount');
                const cartItems = document.getElementById('cartItems');
                const cartTotal = document.getElementById('cartTotal');

                const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
                cartCount.textContent = totalItems;
                if (mobileCartCount) {
                    mobileCartCount.textContent = totalItems;
                }

                if (cart.length === 0) {
                    cartItems.innerHTML = '<p class="text-center text-gray-400">Savat bo\'sh</p>';
                    cartTotal.textContent = '0 so\'m';
                // Don't reset branch selection when cart is empty - keep it for restrictions
                    document.querySelectorAll('.branch-btn').forEach(btn => {
                        btn.classList.remove('border-orange-400', 'scale-105');
                        btn.classList.add('border-transparent');
                    });
                } else {
                    cartItems.innerHTML = cart.map(item => `
                     <div class="bg-gray-800 rounded-xl p-4 flex justify-between items-center">
                         <div class="flex items-center space-x-4">
                             <img src="${item.image}" alt="${item.name}" class="w-16 h-16 object-cover rounded-lg">
                             <div>
                                 <h4 class="font-semibold">${item.selectedSize ? `${item.name} (${item.selectedSize})` : item.name}</h4>
                                 <p class="text-orange-400">${item.price.toLocaleString()} so'm</p>
                             </div>
                         </div>
                         <div class="flex items-center space-x-2">
                             <button onclick="updateQuantity(${item.id}, -1)" class="bg-gray-700 w-8 h-8 rounded-full hover:bg-orange-500 transition">
                                 <i class="fas fa-minus text-sm"></i>
                             </button>
                             <span class="w-8 text-center font-bold">${item.quantity}</span>
                             <button onclick="updateQuantity(${item.id}, 1)" class="bg-gray-700 w-8 h-8 rounded-full hover:bg-orange-500 transition">
                                 <i class="fas fa-plus text-sm"></i>
                             </button>
                             <button onclick="removeFromCart(${item.id})" class="bg-red-600 w-8 h-8 rounded-full hover:bg-red-700 transition ml-2">
                                 <i class="fas fa-trash text-sm"></i>
                             </button>
                         </div>
                     </div>
                 `).join('');

                    const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                    cartTotal.textContent = total.toLocaleString() + ' so\'m';
                }
            }

            // Toggle cart
            function toggleCart() {
                const modal = document.getElementById('cartModal');
                modal.classList.toggle('hidden');

                // Don't reset branch selection when opening cart - keep it for restrictions
                if (!modal.classList.contains('hidden')) {
                    document.querySelectorAll('.branch-btn').forEach(btn => {
                        btn.classList.remove('border-orange-400', 'scale-105');
                        btn.classList.add('border-transparent');
                    });
                    document.getElementById('branchSelectionError').classList.add('hidden');
                }
            }

            // Toggle mobile menu
            function toggleMobileMenu() {
                const mobileMenu = document.getElementById('mobileMenu');
                const mobileMenuBtn = document.getElementById('mobileMenuBtn');

                mobileMenu.classList.toggle('-translate-x-full');

                // Update hamburger icon
                const icon = mobileMenuBtn.querySelector('i');
                if (mobileMenu.classList.contains('-translate-x-full')) {
                    icon.className = 'fas fa-bars text-xl';
                } else {
                    icon.className = 'fas fa-times text-xl';
                }
            }

            // Close mobile menu when clicking outside
            document.addEventListener('click', function (event) {
                const mobileMenu = document.getElementById('mobileMenu');
                const mobileMenuBtn = document.getElementById('mobileMenuBtn');

                if (!mobileMenu.classList.contains('-translate-x-full') &&
                    !mobileMenu.contains(event.target) &&
                    !mobileMenuBtn.contains(event.target)) {
                    mobileMenu.classList.add('-translate-x-full');
                    const icon = mobileMenuBtn.querySelector('i');
                    icon.className = 'fas fa-bars text-xl';
                }
            });

            // Close mobile menu on escape key
            document.addEventListener('keydown', function (event) {
                if (event.key === 'Escape') {
                    const mobileMenu = document.getElementById('mobileMenu');
                    const mobileMenuBtn = document.getElementById('mobileMenuBtn');

                    if (!mobileMenu.classList.contains('-translate-x-full')) {
                        mobileMenu.classList.add('-translate-x-full');
                        const icon = mobileMenuBtn.querySelector('i');
                        icon.className = 'fas fa-bars text-xl';
                    }
                }
            });

            // Checkout
            function checkout() {
                if (cart.length === 0) {
                    showNotification('Savat bo\'sh!', 'error');
                    return;
                }

                // Branch selection is optional now - all products available from all branches

                // Show cart modal with customer info form
                toggleCart();
            }

            // Checkout from cart
            function checkoutFromCart() {
                const customerName = document.getElementById('cartCustomerName').value.trim();
                const customerPhone = document.getElementById('cartCustomerPhone').value.trim();
                const customerLocation = document.getElementById('cartCustomerLocation').value.trim();

                // Branch selection is optional now - all products available from all branches

                if (!customerName || !customerPhone || !customerLocation) {
                    showNotification('Iltimos, barcha maydonlarni to\'ldiring!', 'error');
                    return;
                }

                // Process the order with customer info
                processOrderWithCustomerInfo(customerName, customerPhone, customerLocation);
            }

            // Show customer info modal
            function showCustomerInfoModal() {
                const modal = document.getElementById('customerInfoModal');
                modal.classList.remove('hidden');
            }

            // Close customer info modal
            function closeCustomerInfoModal() {
                const modal = document.getElementById('customerInfoModal');
                modal.classList.add('hidden');
            }

            // Select branch for checkout
            function selectBranchForCheckout(branch) {
                selectedBranch = branch;

                // Remove selection from all buttons
                document.querySelectorAll('#customerInfoModal .branch-btn').forEach(btn => {
                    btn.classList.remove('border-orange-400', 'scale-105');
                    btn.classList.add('border-transparent');
                    btn.querySelector('i').classList.add('hidden');
                });

                // All products are available from all branches now

                // Add selection to clicked button
                const selectedBtn = document.getElementById(`checkoutBranch${branch.charAt(0).toUpperCase() + branch.slice(1)}`);
                if (selectedBtn) {
                    selectedBtn.classList.remove('border-transparent');
                    selectedBtn.classList.add('border-orange-400', 'scale-105');
                    selectedBtn.querySelector('i').classList.remove('hidden');
                }
                
                // Products are now shown only in category modals

                // Hide error message
                document.getElementById('checkoutBranchSelectionError').classList.add('hidden');

                // Branch selection notification removed
            }

            // Send message to sendxabarbolib bot
            function sendToPopaysBot(message, dataType = 'order') {
                try {
                    // Popays bot configuration
                    // Bot token va chat ID ni quyidagicha o'zgartiring:
                    const botToken = 'YOUR_POPAYS_BOT_TOKEN'; // @BotFather dan olingan bot token
                    const chatId = 'YOUR_ADMIN_CHAT_ID'; // Admin chat ID

                    // Agar bot token yoki chat ID o'rnatilmagan bo'lsa, xabarni yubormaslik
                    if (botToken === 'YOUR_POPAYS_BOT_TOKEN' || chatId === 'YOUR_ADMIN_CHAT_ID') {
                        console.log('Popays bot konfiguratsiyasi to\'liq emas. Bot token va chat ID ni o\'rnating.');
                        return;
                    }

                    const url = `https://api.telegram.org/bot${botToken}/sendMessage`;

                    const data = {
                        chat_id: chatId,
                        text: message,
                        parse_mode: 'HTML'
                    };

                    fetch(url, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data)
                    })
                        .then(response => response.json())
                        .then(result => {
                            console.log('Message sent to sendxabarbolib bot:', result);
                        })
                        .catch(error => {
                            console.error('Error sending to sendxabarbolib bot:', error);
                        });

                } catch (error) {
                    console.error('Error in sendToPopaysBot:', error);
                }
            }

            // Process order with customer info
            function processOrderWithCustomerInfo(customerName, customerPhone, customerLocation) {

                const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                const orderDetails = cart.map(item => {
                    const displayName = item.selectedSize ? `${item.name} (${item.selectedSize})` : item.name;
                    return `${displayName} x${item.quantity}`;
                }).join('\n');

                // Try to send to Telegram first
                try {
                    // Check if Telegram Web App is available
                    if (typeof window.Telegram !== 'undefined' && window.Telegram.WebApp) {
                        const tg = window.Telegram.WebApp;

                        // Prepare order data with branch information and map data
                        const orderData = {
                            type: 'order',
                            branch: selectedBranch || 'any',
                            customer: {
                                name: customerName,
                                phone: customerPhone,
                                location: customerLocation
                            },
                            items: cart.map(item => ({
                                id: item.id,
                                name: item.name,
                                price: item.price,
                                quantity: item.quantity,
                                total: item.price * item.quantity,
                                selectedSize: item.selectedSize || null
                            })),
                            total: total,
                            timestamp: new Date().toISOString(),
                            restaurant: 'Popays Fast Food'
                        };

                        // Add map data if coordinates are available
                        if (window.userCoordinates) {
                            const { latitude, longitude } = window.userCoordinates;
                            const googleMapsUrl = `https://www.google.com/maps?q=${latitude},${longitude}`;
                            const yandexMapsUrl = `https://yandex.com/maps/?pt=${longitude},${latitude}&z=16&l=map`;
                            const osmMapsUrl = `https://www.openstreetmap.org/?mlat=${latitude}&mlon=${longitude}&zoom=16`;

                            orderData.mapData = {
                                coordinates: {
                                    latitude: latitude,
                                    longitude: longitude,
                                    accuracy: window.userCoordinates.accuracy
                                },
                                mapLinks: {
                                    google: googleMapsUrl,
                                    yandex: yandexMapsUrl,
                                    osm: osmMapsUrl
                                }
                            };
                        }

                        // Send data to Telegram
                        tg.sendData(JSON.stringify(orderData));

                        // Send to sendxabarbolib bot
                        const branchNames = {
                            'kosmonavt': 'Kosmonavt',
                            'derizli': 'Derizli Kosmonavt',
                            'any': 'Har qanday filial'
                        };

                        let mapLinksText = '';
                        if (window.userCoordinates) {
                            const { latitude, longitude } = window.userCoordinates;
                            const googleMapsUrl = `https://www.google.com/maps?q=${latitude},${longitude}`;
                            const yandexMapsUrl = `https://yandex.com/maps/?pt=${longitude},${latitude}&z=16&l=map`;
                            const osmMapsUrl = `https://www.openstreetmap.org/?mlat=${latitude}&mlon=${longitude}&zoom=16`;

                            mapLinksText = `

üó∫Ô∏è <b>Xarita Havolalari:</b>
üìç Google Maps: ${googleMapsUrl}
üìç Yandex Maps: ${yandexMapsUrl}
üìç OpenStreetMap: ${osmMapsUrl}
üìç Koordinatalar: ${latitude}, ${longitude}`;
                        }

                        const sendXabarBolibMessage = `üçî <b>POPAYS FAST FOOD - YANGI BUYURTMA</b>

üè™ <b>Filial:</b> ${branchNames[selectedBranch] || 'Har qanday filial'}
üë§ <b>Mijoz:</b> ${customerName}
üìû <b>Telefon:</b> ${customerPhone}
üìç <b>Lokatsiya:</b> ${customerLocation}${mapLinksText}

üõí <b>Buyurtma:</b>
${orderDetails}

üí∞ <b>Jami:</b> ${total.toLocaleString()} so'm

‚è∞ <b>Vaqt:</b> ${new Date().toLocaleString('uz-UZ')}`;

                        sendToPopaysBot(sendXabarBolibMessage);

                        // Get current location and send as Telegram location
                        getCurrentLocationAndSend(userLocation);

                        showNotification('Buyurtma Telegram va Popays botga yuborildi! üì±', 'success');

                        // Clear cart after sending
                        cart = [];
                        selectedBranch = null;
                        updateCartUI();
                        toggleCart();

                    } else {
                        // Fallback: show order details and send to appropriate Telegram channel
                        const branchNames = {
                            'kosmonavt': 'Kosmonavt',
                            'derizli': 'Derizli Kosmonavt'
                        };

                        const telegramChannel = selectedBranch === 'derizli' ? '-1003084723234' : 'popays_admin';
                        const channelName = selectedBranch === 'derizli' ? 'Derizli Kosmonavt kanali' : 'Asosiy admin kanali';

                        // Add map links to telegram message if coordinates are available
                        let mapLinksText = '';
                        if (window.userCoordinates) {
                            const { latitude, longitude } = window.userCoordinates;
                            const googleMapsUrl = `https://www.google.com/maps?q=${latitude},${longitude}`;
                            const yandexMapsUrl = `https://yandex.com/maps/?pt=${longitude},${latitude}&z=16&l=map`;
                            const osmMapsUrl = `https://www.openstreetmap.org/?mlat=${latitude}&mlon=${longitude}&zoom=16`;

                            mapLinksText = `

üó∫Ô∏è *Xarita Havolalari:*
üìç Google Maps: ${googleMapsUrl}
üìç Yandex Maps: ${yandexMapsUrl}
üìç OpenStreetMap: ${osmMapsUrl}
üìç Koordinatalar: ${latitude}, ${longitude}`;
                        }

                        const telegramMessage = `üçî *POPAYS FAST FOOD - YANGI BUYURTMA*

üè™ *Filial:* ${branchNames[selectedBranch]}
üë§ *Mijoz:* ${customerName}
üìû *Telefon:* ${customerPhone}
üìç *Lokatsiya:* ${customerLocation}${mapLinksText}

üõí *Buyurtma:*
${orderDetails}

üí∞ *Jami:* ${total.toLocaleString()} so'm

‚è∞ *Vaqt:* ${new Date().toLocaleString('uz-UZ')}

üöö Tez orada operatorimiz siz bilan bog'lanadi!`;

                        // Send to sendxabarbolib bot
                        const sendXabarBolibMessage = `üçî <b>POPAYS FAST FOOD - YANGI BUYURTMA</b>

üè™ <b>Filial:</b> ${branchNames[selectedBranch] || 'Har qanday filial'}
üë§ <b>Mijoz:</b> ${customerName}
üìû <b>Telefon:</b> ${customerPhone}
üìç <b>Lokatsiya:</b> ${customerLocation}${mapLinksText}

üõí <b>Buyurtma:</b>
${orderDetails}

üí∞ <b>Jami:</b> ${total.toLocaleString()} so'm

‚è∞ <b>Vaqt:</b> ${new Date().toLocaleString('uz-UZ')}

üöö Tez orada operatorimiz siz bilan bog'lanadi!`;

                        sendToPopaysBot(sendXabarBolibMessage);

                        // Add map links to order message if coordinates are available
                        let orderMapLinksText = '';
                        if (window.userCoordinates) {
                            const { latitude, longitude } = window.userCoordinates;
                            const googleMapsUrl = `https://www.google.com/maps?q=${latitude},${longitude}`;
                            const yandexMapsUrl = `https://yandex.com/maps/?pt=${longitude},${latitude}&z=16&l=map`;
                            const osmMapsUrl = `https://www.openstreetmap.org/?mlat=${latitude}&mlon=${longitude}&zoom=16`;

                            orderMapLinksText = `

üó∫Ô∏è Xarita Havolalari:
üìç Google Maps: ${googleMapsUrl}
üìç Yandex Maps: ${yandexMapsUrl}
üìç OpenStreetMap: ${osmMapsUrl}
üìç Koordinatalar: ${latitude}, ${longitude}`;
                        }

                        // Show success message with Telegram info
                        const orderMessage = `‚úÖ Buyurtmangiz qabul qilindi!

üè™ Filial: ${branchNames[selectedBranch]}
üë§ Mijoz: ${customerName}
üìû Telefon: ${customerPhone}
üìç Lokatsiya: ${customerLocation}${orderMapLinksText}

üõí Buyurtma:
${orderDetails}

üí∞ Jami: ${total.toLocaleString()} so'm

üì± Buyurtma ${channelName} ga yuborildi!
üöö Tez orada operatorimiz siz bilan bog'lanadi!`;

                        alert(orderMessage);

                        // Send to sendxabarbolib bot
                        sendToPopaysBot(sendXabarBolibMessage);

                        // Show Telegram message for manual copy
                        const modal = document.createElement('div');
                        modal.className = 'fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4';
                        modal.innerHTML = `
                         <div class="bg-gradient-to-br from-gray-900 to-gray-800 rounded-3xl p-8 max-w-2xl w-full max-h-[80vh] overflow-y-auto border border-blue-500/30 slide-in">
                             <div class="flex justify-between items-center mb-6">
                                 <h3 class="text-2xl font-bold bg-gradient-to-r from-blue-400 to-blue-500 bg-clip-text text-transparent">
                                     üì± Telegram ga Yuborish
                                 </h3>
                                 <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-white text-2xl">
                                     <i class="fas fa-times"></i>
                                 </button>
                             </div>
                             <div class="bg-gray-800 rounded-xl p-4 mb-6">
                                 <p class="text-gray-300 mb-4">Filial: <span class="text-blue-400 font-bold">${branchNames[selectedBranch]}</span></p>
                                 <p class="text-gray-300 mb-4">Kanal: <span class="text-green-400 font-bold">${channelName}</span></p>
                                 ${window.userCoordinates ? `
                                 <div class="bg-blue-900/30 rounded-lg p-3 mb-4 border border-blue-500/30">
                                     <p class="text-blue-300 text-sm mb-2">üó∫Ô∏è Xarita Ma'lumotlari:</p>
                                     <p class="text-gray-300 text-xs">üìç Koordinatalar: ${window.userCoordinates.latitude.toFixed(6)}, ${window.userCoordinates.longitude.toFixed(6)}</p>
                                     <p class="text-gray-300 text-xs">üéØ Aniqlik: ¬±${window.userCoordinates.accuracy}m</p>
                                 </div>
                                 ` : ''}
                                 <p class="text-gray-300 mb-4">Quyidagi xabarni Telegram ga nusxalab yuboring:</p>
                                 <textarea class="w-full h-32 bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white focus:border-blue-500 focus:outline-none resize-none" readonly>${telegramMessage}</textarea>
                             </div>
                             <div class="flex space-x-3">
                                 <button onclick="navigator.clipboard.writeText('${telegramMessage.replace(/'/g, "\\'")}').then(() => showNotification('Xabar nusxalandi! üìã', 'success'))" class="flex-1 bg-blue-600 hover:bg-blue-700 py-3 rounded-lg font-semibold transition">
                                     <i class="fas fa-copy mr-2"></i>Nusxalash
                                 </button>
                                 <button onclick="window.open('https://t.me/${telegramChannel}', '_blank')" class="flex-1 bg-green-600 hover:bg-green-700 py-3 rounded-lg font-semibold transition">
                                     <i class="fab fa-telegram mr-2"></i>Telegram
                                 </button>
                             </div>
                         </div>
                     `;
                        document.body.appendChild(modal);

                        // Clear cart
                        cart = [];
                        selectedBranch = null;
                        updateCartUI();
                        toggleCart();
                    }

                } catch (error) {
                    console.error('Telegram yuborishda xatolik:', error);

                    // Fallback to regular checkout
                    const branchNames = {
                        'kosmonavt': 'Kosmonavt',
                        'derizli': 'Derizli Kosmonavt'
                    };

                    const orderMessage = `‚úÖ Buyurtmangiz qabul qilindi!

üè™ Filial: ${branchNames[selectedBranch]}
üë§ Mijoz: ${customerName}
üìû Telefon: ${customerPhone}
üìç Lokatsiya: ${customerLocation}

üõí Buyurtma:
${orderDetails}

üí∞ Jami: ${total.toLocaleString()} so'm

üöö Tez orada operatorimiz siz bilan bog'lanadi!`;

                    alert(orderMessage);

                    cart = [];
                    selectedBranch = null;
                    updateCartUI();
                    toggleCart();
                }
            }

            // Get current location and send to Telegram
            function getCurrentLocationAndSend(location) {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        function (position) {
                            const latitude = position.coords.latitude;
                            const longitude = position.coords.longitude;
                            const accuracy = position.coords.accuracy;

                            // Store coordinates globally
                            window.userCoordinates = { latitude, longitude, accuracy };

                            // Send location to Telegram
                            sendLocationToTelegram(location, latitude, longitude, accuracy);

                            console.log('Lokatsiya olinib Telegram ga yuborildi:', { latitude, longitude, accuracy });
                        },
                        function (error) {
                            console.warn('Lokatsiya olinmadi:', error);
                            // Still try to send the text location
                            sendLocationToTelegram(location);
                        },
                        {
                            enableHighAccuracy: true,
                            timeout: 10000,
                            maximumAge: 60000
                        }
                    );
                } else {
                    console.log('Geolocation qo\'llab-quvvatlanmaydi');
                    // Still try to send the text location
                    sendLocationToTelegram(location);
                }
            }

            // Send location to Telegram with map data
            function sendLocationToTelegram(location, latitude = null, longitude = null, accuracy = null) {
                try {
                    // Check if Telegram Web App is available
                    if (typeof window.Telegram !== 'undefined' && window.Telegram.WebApp) {
                        const tg = window.Telegram.WebApp;

                        // Use passed coordinates or stored coordinates
                        const coords = latitude && longitude ? { latitude, longitude, accuracy } : window.userCoordinates;

                        if (coords) {
                            const { latitude: lat, longitude: lng, accuracy: acc } = coords;

                            // Create map URL for Google Maps and Yandex Maps
                            const googleMapsUrl = `https://www.google.com/maps?q=${lat},${lng}`;
                            const yandexMapsUrl = `https://yandex.com/maps/?pt=${lng},${lat}&z=16&l=map`;
                            const osmMapsUrl = `https://www.openstreetmap.org/?mlat=${lat}&mlon=${lng}&zoom=16`;

                            // Send comprehensive location data including map links
                            tg.sendData(JSON.stringify({
                                type: 'location_complete',
                                coordinates: {
                                    latitude: lat,
                                    longitude: lng,
                                    accuracy: acc
                                },
                                address: location,
                                maps: {
                                    google: googleMapsUrl,
                                    yandex: yandexMapsUrl,
                                    osm: osmMapsUrl
                                },
                                timestamp: new Date().toISOString(),
                                restaurant: 'Popays Fast Food'
                            }));

                            console.log('To\'liq lokatsiya ma\'lumotlari Telegram ga yuborildi:', {
                                latitude: lat,
                                longitude: lng,
                                accuracy: acc,
                                maps: { google: googleMapsUrl, yandex: yandexMapsUrl, osm: osmMapsUrl }
                            });

                            // Send as Telegram location (this is the main location sharing)
                            try {
                                // Use the main Telegram WebApp method to send location
                                tg.sendData(JSON.stringify({
                                    type: 'location',
                                    latitude: lat,
                                    longitude: lng,
                                    accuracy: acc,
                                    address: location,
                                    timestamp: new Date().toISOString()
                                }));

                                // Also try the direct location method if available
                                if (typeof tg.sendLocation === 'function') {
                                    tg.sendLocation(lat, lng);
                                    console.log('Telegram location yuborildi (direct method)');
                                } else {
                                    console.log('Telegram location yuborildi (via sendData)');
                                }
                            } catch (locError) {
                                console.log('Telegram location yuborishda xatolik:', locError);
                            }

                            // Send map image if available
                            sendMapImageToTelegram(lat, lng);

                        } else {
                            // Try to extract coordinates from location string
                            const coordMatch = location.match(/Koordinatalar:\s*([\d.-]+),\s*([\d.-]+)/);
                            if (coordMatch) {
                                const latitude = parseFloat(coordMatch[1]);
                                const longitude = parseFloat(coordMatch[2]);

                                // Create map URLs
                                const googleMapsUrl = `https://www.google.com/maps?q=${latitude},${longitude}`;
                                const yandexMapsUrl = `https://yandex.com/maps/?pt=${longitude},${latitude}&z=16&l=map`;
                                const osmMapsUrl = `https://www.openstreetmap.org/?mlat=${latitude}&mlon=${longitude}&zoom=16`;

                                // Send location with map links
                                tg.sendData(JSON.stringify({
                                    type: 'location_with_maps',
                                    coordinates: {
                                        latitude: latitude,
                                        longitude: longitude
                                    },
                                    address: location,
                                    maps: {
                                        google: googleMapsUrl,
                                        yandex: yandexMapsUrl,
                                        osm: osmMapsUrl
                                    },
                                    timestamp: new Date().toISOString(),
                                    restaurant: 'Popays Fast Food'
                                }));

                                console.log('Lokatsiya va xarita havolalari Telegram ga yuborildi:', { latitude, longitude });
                            } else {
                                // If no coordinates, send as text with restaurant info
                                tg.sendData(JSON.stringify({
                                    type: 'location_text',
                                    address: location,
                                    timestamp: new Date().toISOString(),
                                    restaurant: 'Popays Fast Food',
                                    note: 'Koordinatalar mavjud emas, faqat manzil matni'
                                }));

                                console.log('Lokatsiya matni Telegram ga yuborildi:', location);
                            }
                        }
                    }
                } catch (error) {
                    console.error('Lokatsiya yuborishda xatolik:', error);
                }
            }

            // Send map image to Telegram
            function sendMapImageToTelegram(latitude, longitude) {
                try {
                    if (typeof window.Telegram !== 'undefined' && window.Telegram.WebApp) {
                        const tg = window.Telegram.WebApp;

                        // Create multiple static map image URLs
                        const mapImageUrls = {
                            osm: `https://staticmap.openstreetmap.de/staticmap.php?center=${latitude},${longitude}&zoom=16&size=600x400&maptype=mapnik&markers=${latitude},${longitude},red`,
                            osmDetailed: `https://staticmap.openstreetmap.de/staticmap.php?center=${latitude},${longitude}&zoom=18&size=800x600&maptype=mapnik&markers=${latitude},${longitude},red`,
                            osmSatellite: `https://staticmap.openstreetmap.de/staticmap.php?center=${latitude},${longitude}&zoom=16&size=600x400&maptype=osm-carto&markers=${latitude},${longitude},red`
                        };

                        // Send comprehensive map data
                        tg.sendData(JSON.stringify({
                            type: 'map_images_complete',
                            coordinates: {
                                latitude: latitude,
                                longitude: longitude
                            },
                            mapImages: mapImageUrls,
                            mapLinks: {
                                google: `https://www.google.com/maps?q=${latitude},${longitude}`,
                                yandex: `https://yandex.com/maps/?pt=${longitude},${latitude}&z=16&l=map`,
                                osm: `https://www.openstreetmap.org/?mlat=${latitude}&mlon=${longitude}&zoom=16`
                            },
                            timestamp: new Date().toISOString(),
                            note: 'Xarita tasvirlari OpenStreetMap dan olingan, turli xil formatlar'
                        }));

                        console.log('To\'liq xarita ma\'lumotlari Telegram ga yuborildi:', {
                            coordinates: { latitude, longitude },
                            mapImages: mapImageUrls
                        });

                    }
                } catch (error) {
                    console.error('Xarita tasviri yuborishda xatolik:', error);
                }
            }

            // Save map data to JSON file
            function saveMapDataToJSON(mapData, userName, userPhone) {
                try {
                    // Create map data entry
                    const mapEntry = {
                        id: Date.now(),
                        timestamp: new Date().toISOString(),
                        customer: {
                            name: userName,
                            phone: userPhone
                        },
                        coordinates: mapData.coordinates,
                        mapLinks: mapData.mapLinks,
                        status: 'active'
                    };

                    // Get existing map data from localStorage
                    let existingMapData = JSON.parse(localStorage.getItem('popaysMapData')) || [];

                    // Add new entry
                    existingMapData.push(mapEntry);

                    // Keep only last 100 entries to avoid memory issues
                    if (existingMapData.length > 100) {
                        existingMapData = existingMapData.slice(-100);
                    }

                    // Save to localStorage
                    localStorage.setItem('popaysMapData', JSON.stringify(existingMapData));

                    // Also save to sessionStorage for current session
                    sessionStorage.setItem('popaysMapData', JSON.stringify(existingMapData));

                    console.log('üó∫Ô∏è Map data saved to JSON storage:', mapEntry);

                    // Try to save to popaysadmin.json if possible
                    saveMapDataToFile(mapData, userName, userPhone);

                } catch (error) {
                    console.error('Map data saqlashda xatolik:', error);
                }
            }

            // Save map data to file (links only, no images)
            function saveMapDataToFile(mapData, userName, userPhone) {
                try {
                    // Create file content with only links (no static map images)
                    const fileContent = {
                        mapData: {
                            id: Date.now(),
                            timestamp: new Date().toISOString(),
                            customer: {
                                name: userName,
                                phone: userPhone
                            },
                            coordinates: mapData.coordinates,
                            mapLinks: mapData.mapLinks,
                            note: 'Xarita havolalari saqlandi (tasvir emas)',
                            status: 'active'
                        },
                        lastUpdated: new Date().toISOString()
                    };

                    // Create download link for the file
                    const dataStr = JSON.stringify(fileContent, null, 2);
                    const dataBlob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(dataBlob);

                    // Create download link
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = 'popays_mapdata_links.json';
                    link.style.display = 'none';

                    // Trigger download
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);

                    // Clean up
                    URL.revokeObjectURL(url);

                    console.log('üó∫Ô∏è Map data file downloaded (links only):', fileContent);

                } catch (error) {
                    console.error('Map data file yaratishda xatolik:', error);
                }
            }

            // Send map data separately to Telegram (only links, no images)
            function sendMapDataToTelegram(mapData, userName, userPhone) {
                try {
                    if (typeof window.Telegram !== 'undefined' && window.Telegram.WebApp) {
                        const tg = window.Telegram.WebApp;

                        // Create map message with only links (no static map image)
                        const mapMessage = {
                            type: 'map_data_links_only',
                            timestamp: new Date().toISOString(),
                            customer: {
                                name: userName,
                                phone: userPhone
                            },
                            coordinates: mapData.coordinates,
                            mapLinks: mapData.mapLinks,
                            note: 'Xarita havolalari (tasvir emas)'
                        };

                        // Send map data
                        tg.sendData(JSON.stringify(mapMessage));

                        // Send as formatted text message with clickable links
                        const textMessage = `üó∫Ô∏è *XARITA HAVOLALARI*

üë§ *Mijoz:* ${customerName}
üìû *Telefon:* ${customerPhone}
üìç *Koordinatalar:* ${mapData.coordinates.latitude}, ${mapData.coordinates.longitude}
üéØ *Aniqlik:* ¬±${mapData.coordinates.accuracy}m

üó∫Ô∏è *Xarita Havolalari:*
üìç [Google Maps](${mapData.mapLinks.google})
üìç [Yandex Maps](${mapData.mapLinks.yandex})
üìç [OpenStreetMap](${mapData.mapLinks.osm})

‚è∞ *Vaqt:* ${new Date().toLocaleString('uz-UZ')}

üí° *Eslatma:* Havolalarni bosing va xaritani oching!`;

                        // Send text message
                        tg.sendData(JSON.stringify({
                            type: 'map_links_message',
                            message: textMessage,
                            timestamp: new Date().toISOString()
                        }));

                        console.log('üó∫Ô∏è Map links sent to Telegram (no images):', mapMessage);

                    }
                } catch (error) {
                    console.error('Map data Telegram ga yuborishda xatolik:', error);
                }
            }

            // Load VIP settings

            // Save VIP settings


            // Load About settings

            // Save About settings

            // Load users list

            // Load dynamic content from localStorage
            function loadDynamicContent() {
                // Load all data from JSON file
                if (window.appData) {
                    // Load products
                    if (window.appData.products) {
                        products = window.appData.products;
                        console.log('Products loaded from JSON file:', products);
                        console.log('Number of products loaded:', products.length);
                    } else {
                        console.log('No products found in JSON file');
                    }

                    // Load admin data
                    if (window.appData.admin) {
                        adminData = window.appData.admin;
                        console.log('Admin data loaded from JSON file:', adminData);
                    }

                    // Load registered users
                    if (window.appData.registeredUsers) {
                        localStorage.setItem('registeredUsers', JSON.stringify(window.appData.registeredUsers));
                        console.log('Registered users loaded from JSON file:', window.appData.registeredUsers);
                    }

                    // Load map data
                    if (window.appData.mapData) {
                        localStorage.setItem('popaysMapData', JSON.stringify(window.appData.mapData));
                        console.log('Map data loaded from JSON file:', window.appData.mapData);
                    }

                    // Load VIP settings
                    if (window.appData.vipSettings) {
                        localStorage.setItem('vipSettings', JSON.stringify(window.appData.vipSettings));
                        console.log('VIP settings loaded from JSON file:', window.appData.vipSettings);
                    }

                    // Load About settings
                    if (window.appData.aboutSettings) {
                        localStorage.setItem('aboutSettings', JSON.stringify(window.appData.aboutSettings));
                        console.log('About settings loaded from JSON file:', window.appData.aboutSettings);
                    }
                }

                // Update VIP section display
                vipData = window.appData?.vipSettings || JSON.parse(localStorage.getItem('vipSettings')) || {};
                if (vipData.title) {
                    document.getElementById('vipSectionTitle').textContent = vipData.title;
                    document.getElementById('vipDiscountText').textContent = vipData.discount || '20 gacha chegirma';
                    document.getElementById('vipMinOrderText').textContent = vipData.minOrder || '100,000 so\'mdan ortiq buyurtmaga';
                    document.getElementById('vipFreeDeliveryText').textContent = vipData.freeDelivery || '3kmgacha dastavka bepul';
                    document.getElementById('vipFreeDeliveryTitle').textContent = vipData.freeDeliveryTitle || 'BEPUL YETKAZIB BERISH';
                    document.getElementById('vipGiftText').textContent = vipData.gift || 'Har 3-buyurtmaga bepul desert';
                    document.getElementById('vipGiftTitle').textContent = vipData.giftTitle || 'SOVG\'A';
                }

                // Load About settings
                aboutData = window.appData?.aboutSettings;
                if (!aboutData) {
                    aboutData = JSON.parse(localStorage.getItem('aboutSettings')) || {};
                }
                if (aboutData.advantage1) {
                    document.getElementById('aboutAdvantage1Text').textContent = aboutData.advantage1;
                    document.getElementById('aboutAdvantage2Text').textContent = aboutData.advantage2;
                    document.getElementById('aboutAdvantage3Text').textContent = aboutData.advantage3;
                    document.getElementById('aboutAdvantage4Text').textContent = aboutData.advantage4;
                    document.getElementById('aboutCustomersText').textContent = aboutData.customers;
                    document.getElementById('aboutExperienceText').textContent = aboutData.experience;
                    document.getElementById('aboutGoalText').textContent = aboutData.goal;
                    document.getElementById('aboutValuesText').textContent = aboutData.values;
                }
            }

            // Load app data from JSON file
            async function loadAppData() {
                try {
                    // Load products from database
                    console.log('Loading products from database...');
                    const dbProducts = await loadProductsFromDatabase();

                    if (dbProducts && dbProducts.length > 0) {
                        products = dbProducts;
                        console.log('Products loaded from database:', products.length);
                    } else {
                        console.log('No products found, using default products');
                        loadDefaultProducts();
                    }
                } catch (error) {
                    console.log('Error loading data:', error);
                    loadDefaultProducts();
                }
            }

            // Load products from JSON file
            async function loadProductsFromDatabase() {
                try {
                    // JSON fayldan mahsulotlarni olish
                    const response = await fetch('./products.json');
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const dbProducts = await response.json();

                    if (dbProducts && dbProducts.length > 0) {
                        // Transform database products to match expected format
                        return dbProducts.map(product => ({
                            id: product.id,
                            name: product.name,
                            price: product.price,
                            category: product.category,
                            image: product.img || 'imgs/Artboard 1 copy 9.png', // Default image if none provided
                            description: product.description || '',
                            stock: product.stock || 0,
                            sizes: product.sizes || null // Include sizes if available
                        }));
                    }

                    // Fallback to static data if database is empty
                    console.log('Database bo\'sh, fallback ma\'lumotlar ishlatilmoqda');
                    return [];
                } catch (error) {
                    console.error('Database\'dan mahsulotlar yuklashda xatolik:', error);
                    return [];
                }
            }

            // Load default products as fallback
            function loadDefaultProducts() {
                console.log('Loading default products as fallback...');
                // Set empty products array - this will show empty state
                products = [];
            }

            // Save app data to file (download as JSON)
            function saveAppDataToFile() {
                if (!window.appData) return;

                const dataStr = JSON.stringify(window.appData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);

                const link = document.createElement('a');
                link.href = url;
                link.download = 'popaysadmin_updated.json';
                link.click();

                URL.revokeObjectURL(url);
                console.log('App data exported to file');
            }

            // Save all data to JSON file structure
            function saveAllDataToJSON() {
                // Ensure window.appData exists
                if (!window.appData) {
                    window.appData = {};
                }

                // Update all data in appData
                window.appData.products = products;
                window.appData.admin = adminData;
                window.appData.vipSettings = vipData;
                window.appData.aboutSettings = aboutData;
                window.appData.registeredUsers = JSON.parse(localStorage.getItem('registeredUsers')) || [];
                window.appData.mapData = JSON.parse(localStorage.getItem('popaysMapData')) || {
                    description: "Mijozlarning xarita ma'lumotlari va lokatsiyalari",
                    entries: [],
                    lastUpdated: "",
                    totalEntries: 0
                };

                // Save VIP settings if they exist
                const vipSettings = JSON.parse(localStorage.getItem('vipSettings'));
                if (vipSettings) {
                    window.appData.vipSettings = vipSettings;
                }

                // Save About settings if they exist
                const aboutSettings = JSON.parse(localStorage.getItem('aboutSettings'));
                if (aboutSettings) {
                    window.appData.aboutSettings = aboutSettings;
                }

                // Save to localStorage as backup
                localStorage.setItem('popaysData', JSON.stringify(window.appData));

                console.log('All data saved to JSON structure:', window.appData);
            }

            // Initialize Telegram Web App
            function initializeTelegramWebApp() {
                try {
                    if (typeof window.Telegram !== 'undefined' && window.Telegram.WebApp) {
                        const tg = window.Telegram.WebApp;

                        // Initialize the app
                        tg.ready();

                        // Set theme
                        tg.setHeaderColor('#1f2937'); // Dark theme
                        tg.setBackgroundColor('#111827');

                        // Enable closing confirmation
                        tg.enableClosingConfirmation();

                        // Set main button if needed
                        // tg.MainButton.setText('Buyurtma berish');
                        // tg.MainButton.show();

                        console.log('Telegram Web App muvaffaqiyatli ishga tushdi!');

                        // Show notification
                        showNotification('Telegram Web App tayyor! üì±', 'success');

                    } else {
                        console.log('Telegram Web App mavjud emas - oddiy brauzer rejimida ishlayapti');
                    }
                } catch (error) {
                    console.error('Telegram Web App ishga tushirishda xatolik:', error);
                }
            }

            // Send order to Telegram
            function sendToTelegram() {
                if (cart.length === 0) {
                    showNotification('Savat bo\'sh!', 'error');
                    return;
                }

                // Check if user is logged in
                if (!localStorage.getItem('userLoggedIn')) {
                    showNotification('Iltimos, avval ma\'lumotlaringizni kiriting!', 'error');
                    toggleLogin();
                    return;
                }

                try {
                    // Check if Telegram Web App is available
                    if (typeof window.Telegram !== 'undefined' && window.Telegram.WebApp) {
                        const tg = window.Telegram.WebApp;

                        // Prepare order data
                        const userName = localStorage.getItem('userName');
                        const userPhone = localStorage.getItem('userPhone');
                        const userLocation = localStorage.getItem('userLocation');
                        const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

                        // Get current location coordinates
                        if (navigator.geolocation) {
                            navigator.geolocation.getCurrentPosition(
                                function (position) {
                                    const coords = position.coords;

                                    // Create map data structure
                                    const mapData = {
                                        coordinates: {
                                            latitude: coords.latitude,
                                            longitude: coords.longitude,
                                            accuracy: Math.round(coords.accuracy)
                                        },
                                        mapLinks: {
                                            google: `https://www.google.com/maps?q=${coords.latitude},${coords.longitude}`,
                                            yandex: `https://yandex.com/maps/?pt=${coords.longitude},${coords.latitude}&z=16&l=map`,
                                            osm: `https://www.openstreetmap.org/?mlat=${coords.latitude}&mlon=${coords.longitude}&zoom=16`
                                        }
                                    };

                                    // Save map data to JSON file
                                    saveMapDataToJSON(mapData, userName, userPhone);

                                    const orderData = {
                                        type: 'order',
                                        customer: {
                                            name: userName,
                                            phone: userPhone,
                                            location: userLocation
                                        },
                                        items: cart.map(item => ({
                                            id: item.id,
                                            name: item.name,
                                            price: item.price,
                                            quantity: item.quantity,
                                            total: item.price * item.quantity,
                                            selectedSize: item.selectedSize || null
                                        })),
                                        total: total,
                                        timestamp: new Date().toISOString(),
                                        restaurant: 'Popays Fast Food',
                                        mapData: mapData
                                    };

                                    console.log('üó∫Ô∏è Sending order with map data:', orderData);

                                    // Send data to Telegram bot
                                    tg.sendData(JSON.stringify(orderData));

                                    // Also send map data separately to ensure it reaches
                                    sendMapDataToTelegram(mapData, userName, userPhone);

                                    showNotification('Buyurtma Telegram ga yuborildi! üì±', 'success');

                                    // Clear cart after sending
                                    cart = [];
                                    updateCartUI();
                                    toggleCart();
                                },
                                function (error) {
                                    console.warn('Lokatsiya olinmadi:', error);

                                    // Send order without map data
                                    const orderData = {
                                        type: 'order',
                                        customer: {
                                            name: userName,
                                            phone: userPhone,
                                            location: userLocation
                                        },
                                        items: cart.map(item => ({
                                            id: item.id,
                                            name: item.name,
                                            price: item.price,
                                            quantity: item.quantity,
                                            total: item.price * item.quantity,
                                            selectedSize: item.selectedSize || null
                                        })),
                                        total: total,
                                        timestamp: new Date().toISOString(),
                                        restaurant: 'Popays Fast Food'
                                    };

                                    console.log('üìç Sending order without map data:', orderData);

                                    // Send data to Telegram bot
                                    tg.sendData(JSON.stringify(orderData));

                                    showNotification('Buyurtma Telegram ga yuborildi! üì± (Lokatsiya yo\'q)', 'success');

                                    // Clear cart after sending
                                    cart = [];
                                    updateCartUI();
                                    toggleCart();
                                },
                                {
                                    enableHighAccuracy: true,
                                    timeout: 10000,
                                    maximumAge: 60000
                                }
                            );
                        } else {
                            // Geolocation not supported, send order without map data
                            const orderData = {
                                type: 'order',
                                customer: {
                                    name: userName,
                                    phone: userPhone,
                                    location: userLocation
                                },
                                items: cart.map(item => ({
                                    id: item.id,
                                    name: item.name,
                                    price: item.price,
                                    quantity: item.quantity,
                                    total: item.price * item.quantity
                                })),
                                total: total,
                                timestamp: new Date().toISOString(),
                                restaurant: 'Popays Fast Food'
                            };

                            console.log('üìç Geolocation not supported, sending order without map data:', orderData);

                            // Send data to Telegram bot
                            tg.sendData(JSON.stringify(orderData));

                            showNotification('Buyurtma Telegram ga yuborildi! üì± (Lokatsiya yo\'q)', 'success');

                            // Clear cart after sending
                            cart = [];
                            updateCartUI();
                            toggleCart();
                        }

                    } else {
                        // Fallback: show order details for manual copy
                        const userName = localStorage.getItem('userName');
                        const userPhone = localStorage.getItem('userPhone');
                        const userLocation = localStorage.getItem('userLocation');
                        const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                        const orderDetails = cart.map(item => {
                            const displayName = item.selectedSize ? `${item.name} (${item.selectedSize})` : item.name;
                            return `${displayName} x${item.quantity} - ${item.price.toLocaleString()} so'm`;
                        }).join('\n');

                        const telegramMessage = `üçî *POPAYS FAST FOOD - YANGI BUYURTMA*

üë§ *Mijoz:* ${customerName}
üìû *Telefon:* ${customerPhone}
üìç *Lokatsiya:* ${customerLocation}

üõí *Buyurtma:*
${orderDetails}

üí∞ *Jami:* ${total.toLocaleString()} so'm

‚è∞ *Vaqt:* ${new Date().toLocaleString('uz-UZ')}

üöö Tez orada operatorimiz siz bilan bog'lanadi!`;

                        // Show message for manual copy
                        const modal = document.createElement('div');
                        modal.className = 'fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4';
                        modal.innerHTML = `
                        <div class="bg-gradient-to-br from-gray-900 to-gray-800 rounded-3xl p-8 max-w-2xl w-full max-h-[80vh] overflow-y-auto border border-blue-500/30 slide-in">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-2xl font-bold bg-gradient-to-r from-blue-400 to-blue-500 bg-clip-text text-transparent">
                                    üì± Telegram ga Yuborish
                                </h3>
                                <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-white text-2xl">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="bg-gray-800 rounded-xl p-4 mb-6">
                                <p class="text-gray-300 mb-4">Quyidagi xabarni Telegram ga nusxalab yuboring:</p>
                                <textarea class="w-full h-32 bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white focus:border-blue-500 focus:outline-none resize-none" readonly>${telegramMessage}</textarea>
                            </div>
                            <div class="flex space-x-3">
                                <button onclick="navigator.clipboard.writeText('${telegramMessage.replace(/'/g, "\\'")}').then(() => showNotification('Xabar nusxalandi! üìã', 'success'))" class="text-blue-600 hover:bg-blue-700 py-3 rounded-lg font-semibold transition">
                                    <i class="fas fa-copy mr-2"></i>Nusxalash
                                </button>
                                <button onclick="window.open('https://t.me/popays_admin', '_blank')" class="flex-1 bg-green-600 hover:bg-green-700 py-3 rounded-lg font-semibold transition">
                                    <i class="fab fa-telegram mr-2"></i>Telegram
                                </button>
                            </div>
                        </div>
                    `;
                        document.body.appendChild(modal);

                        // Clear cart after showing modal
                        cart = [];
                        updateCartUI();
                        toggleCart();
                    }

                } catch (error) {
                    console.error('Telegram yuborishda xatolik:', error);
                    showNotification('Telegram yuborishda xatolik yuz berdi!', 'error');
                }
            }

            // Show notification
            function showNotification(message, type = 'success') {
                // Create unique key for this notification
                const notificationKey = `${message}_${type}`;
                
                // Check if this notification is already active
                if (activeNotifications[notificationKey]) {
                    // Increment counter
                    notificationCounter[notificationKey] = (notificationCounter[notificationKey] || 1) + 1;
                    
                    // Update existing notification
                    const existingNotification = activeNotifications[notificationKey];
                    const counterText = notificationCounter[notificationKey] > 1 ? ` x${notificationCounter[notificationKey]}` : '';
                    existingNotification.innerHTML = existingNotification.innerHTML.replace(/ x\d+$/, '') + counterText;
                    
                    // Reset timer
                    clearTimeout(existingNotification.timer);
                    existingNotification.timer = setTimeout(() => {
                        existingNotification.remove();
                        delete activeNotifications[notificationKey];
                        delete notificationCounter[notificationKey];
                    }, 3000);
                    
                    return;
                }
                
                // Create new notification
                const notification = document.createElement('div');
                let bgClass = 'bg-gradient-to-r from-green-500 to-green-600';
                let icon = 'fas fa-check-circle';

                if (type === 'error') {
                    bgClass = 'bg-gradient-to-r from-red-500 to-red-600';
                    icon = 'fas fa-exclamation-circle';
                } else if (type === 'warning') {
                    bgClass = 'bg-gradient-to-r from-yellow-500 to-orange-500';
                    icon = 'fas fa-exclamation-triangle';
                }

                notification.className = `fixed bottom-4 right-4 ${bgClass} text-white px-6 py-3 rounded-full shadow-lg z-50 slide-in`;
                notification.innerHTML = `<i class="${icon} mr-2"></i>${message}`;
                document.body.appendChild(notification);
                
                // Store notification reference and counter
                activeNotifications[notificationKey] = notification;
                notificationCounter[notificationKey] = 1;
                
                // Set timer
                notification.timer = setTimeout(() => {
                    notification.remove();
                    delete activeNotifications[notificationKey];
                    delete notificationCounter[notificationKey];
                }, 3000);
            }
            // Generate admin sharing link - O'CHIRILDI

            // Scroll to menu
            function scrollToMenu() {
                document.getElementById('menu').scrollIntoView({ behavior: 'smooth' });
            }

            // Handle contact form submission
            function handleContactForm(e) {
                e.preventDefault();

                const contactName = document.getElementById('contactName').value.trim();
                const contactPhone = document.getElementById('contactPhone').value.trim();
                const contactEmail = document.getElementById('contactEmail').value.trim();
                const contactMessage = document.getElementById('contactMessage').value.trim();

                // Reset error states
                document.getElementById('contactName').classList.remove('border-red-500');
                document.getElementById('contactPhone').classList.remove('border-red-500');
                document.getElementById('contactMessage').classList.remove('border-red-500');

                let hasError = false;

                // Check if required fields are filled
                if (!contactName) {
                    showNotification('Iltimos, ismingizni kiriting!', 'error');
                    document.getElementById('contactName').classList.add('border-red-500');
                    document.getElementById('contactName').focus();
                    hasError = true;
                }

                if (!contactPhone) {
                    showNotification('Iltimos, telefon raqamingizni kiriting!', 'error');
                    document.getElementById('contactPhone').classList.add('border-red-500');
                    if (!hasError) document.getElementById('contactPhone').focus();
                    hasError = true;
                }

                if (!contactMessage) {
                    showNotification('Iltimos, xabaringizni yozing!', 'error');
                    document.getElementById('contactMessage').classList.add('border-red-500');
                    if (!hasError) document.getElementById('contactMessage').focus();
                    hasError = true;
                }

                if (hasError) {
                    return;
                }

                // Try to send to Telegram first
                try {
                    // Check if Telegram Web App is available
                    if (typeof window.Telegram !== 'undefined' && window.Telegram.WebApp) {
                        const tg = window.Telegram.WebApp;

                        // Prepare contact data
                        const contactData = {
                            type: 'contact',
                            customer: {
                                name: contactName,
                                phone: contactPhone,
                                email: contactEmail || 'Kiritilmagan'
                            },
                            message: contactMessage,
                            timestamp: new Date().toISOString(),
                            restaurant: 'Popays Fast Food'
                        };

                        // Send data to Telegram
                        tg.sendData(JSON.stringify(contactData));

                        // Send to sendxabarbolib bot
                        const sendXabarBolibContactMessage = `‚úâÔ∏è <b>POPAYS FAST FOOD - YANGI XABAR</b>

üë§ <b>Mijoz:</b> ${contactName}
üìû <b>Telefon:</b> ${contactPhone}
üìß <b>Email:</b> ${contactEmail || 'Kiritilmagan'}

üí¨ <b>Xabar:</b>
${contactMessage}

‚è∞ <b>Vaqt:</b> ${new Date().toLocaleString('uz-UZ')}

üöö Tez orada operatorimiz siz bilan bog'lanadi!`;

                        sendToPopaysBot(sendXabarBolibContactMessage, 'contact');

                        showNotification('Xabaringiz Telegram va Popays botga yuborildi! üì±', 'success');

                        // Reset form
                        document.getElementById('contactForm').reset();

                    } else {
                        // Fallback: show contact details and Telegram message
                        const telegramMessage = `‚úâÔ∏è *POPAYS FAST FOOD - YANGI XABAR*

üë§ *Mijoz:* ${contactName}
üìû *Telefon:* ${contactPhone}
üìß *Email:* ${contactEmail || 'Kiritilmagan'}

üí¨ *Xabar:*
${contactMessage}

‚è∞ *Vaqt:* ${new Date().toLocaleString('uz-UZ')}

üöö Tez orada operatorimiz siz bilan bog'lanadi!`;

                        // Show success message with Telegram info
                        const contactSuccessMessage = `‚úÖ Xabaringiz qabul qilindi!

üë§ Mijoz: ${contactName}
üìû Telefon: ${contactPhone}
üìß Email: ${contactEmail || 'Kiritilmagan'}

üí¨ Xabar: ${contactMessage}

üì± Xabar Telegram ga yuborildi!
üöö Tez orada operatorimiz siz bilan bog'lanadi!`;

                        alert(contactSuccessMessage);

                        // Send to Popays bot
                        sendToPopaysBot(sendXabarBolibContactMessage, 'contact');

                        // Show Telegram message for manual copy
                        const modal = document.createElement('div');
                        modal.className = 'fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4';
                        modal.innerHTML = `
                        <div class="bg-gradient-to-br from-gray-900 to-gray-800 rounded-3xl p-8 max-w-2xl w-full max-h-[80vh] overflow-y-auto border border-blue-500/30 slide-in">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-2xl font-bold bg-gradient-to-r from-blue-400 to-blue-500 bg-clip-text text-transparent">
                                    üì± Telegram ga Yuborish
                                </h3>
                                <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-white text-2xl">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="bg-gray-800 rounded-xl p-4 mb-6">
                                <p class="text-gray-300 mb-4">Quyidagi xabarni Telegram ga nusxalab yuboring:</p>
                                <textarea class="w-full h-32 bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white focus:border-blue-500 focus:outline-none resize-none" readonly>${telegramMessage}</textarea>
                            </div>
                            <div class="flex space-x-3">
                                <button onclick="navigator.clipboard.writeText('${telegramMessage.replace(/'/g, "\\'")}').then(() => showNotification('Xabar nusxalandi! üìã', 'success'))" class="flex-1 bg-blue-600 hover:bg-blue-700 py-3 rounded-lg font-semibold transition">
                                    <i class="fas fa-copy mr-2"></i>Nusxalash
                                </button>
                                <button onclick="window.open('https://t.me/popays_admin', '_blank')" class="flex-1 bg-green-600 hover:bg-green-700 py-3 rounded-lg font-semibold transition">
                                    <i class="fab fa-telegram mr-2"></i>Telegram
                                </button>
                            </div>
                        </div>
                    `;
                        document.body.appendChild(modal);

                        // Reset form
                        document.getElementById('contactForm').reset();
                    }

                } catch (error) {
                    console.error('Telegram yuborishda xatolik:', error);

                    // Fallback to regular contact submission
                    const contactSuccessMessage = `‚úÖ Xabaringiz qabul qilindi!

üë§ Mijoz: ${contactName}
üìû Telefon: ${contactPhone}
üìß Email: ${contactEmail || 'Kiritilmagan'}

üí¨ Xabar: ${contactMessage}

üöö Tez orada operatorimiz siz bilan bog'lanadi!`;

                    alert(contactSuccessMessage);

                    // Send to sendxabarbolib bot even in error case
                    const sendXabarBolibContactMessage = `‚úâÔ∏è <b>POPAYS FAST FOOD - YANGI XABAR</b>

üë§ <b>Mijoz:</b> ${contactName}
üìû <b>Telefon:</b> ${contactPhone}
üìß <b>Email:</b> ${contactEmail || 'Kiritilmagan'}

üí¨ <b>Xabar:</b>
${contactMessage}

‚è∞ <b>Vaqt:</b> ${new Date().toLocaleString('uz-UZ')}

üöö Tez orada operatorimiz siz bilan bog'lanadi!`;

                    sendToPopaysBot(sendXabarBolibContactMessage, 'contact');

                    // Reset form
                    document.getElementById('contactForm').reset();
                }
            }

            // Remove error states when user starts typing in contact form
            function removeContactErrorState(inputId) {
                document.getElementById(inputId).classList.remove('border-red-500');
            }

            // Loading Animation Logic
            window.addEventListener('load', function () {
                // Minimum loading time (2 seconds)
                const minLoadingTime = 2000;
                const startTime = Date.now();

                // Hide loading screen and show main content
                function hideLoadingScreen() {
                    const loadingScreen = document.getElementById('loadingScreen');
                    const mainContent = document.getElementById('mainContent');

                    // Add fade-out class to loading screen
                    loadingScreen.classList.add('fade-out');

                    // Show main content
                    mainContent.classList.add('loaded');

                    // Remove loading screen from DOM after animation
                    setTimeout(() => {
                        loadingScreen.style.display = 'none';
                    }, 500);
                }

                // Calculate remaining time to reach minimum loading time
                const elapsedTime = Date.now() - startTime;
                const remainingTime = Math.max(0, minLoadingTime - elapsedTime);

                // Hide loading screen after minimum time
                setTimeout(hideLoadingScreen, remainingTime);
            });
        </script>
    </div> <!-- End of main-content -->
</body>

</html>